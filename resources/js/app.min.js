!function(){"use strict";var e=function(){function e(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}return e.prototype={negative:function(){return new e(-this.x,-this.y,-this.z)},add:function(t){return t instanceof e?new e(this.x+t.x,this.y+t.y,this.z+t.z):new e(this.x+t,this.y+t,this.z+t)},subtract:function(t){return t instanceof e?new e(this.x-t.x,this.y-t.y,this.z-t.z):new e(this.x-t,this.y-t,this.z-t)},multiply:function(t){return t instanceof e?new e(this.x*t.x,this.y*t.y,this.z*t.z):new e(this.x*t,this.y*t,this.z*t)},divide:function(t){return t instanceof e?new e(this.x/t.x,this.y/t.y,this.z/t.z):new e(this.x/t,this.y/t,this.z/t)},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new e(this.x,this.y,this.z)},init:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},e.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.add=function(t,n,r){return n instanceof e?(r.x=t.x+n.x,r.y=t.y+n.y,r.z=t.z+n.z):(r.x=t.x+n,r.y=t.y+n,r.z=t.z+n),r},e.subtract=function(t,n,r){return n instanceof e?(r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z):(r.x=t.x-n,r.y=t.y-n,r.z=t.z-n),r},e.multiply=function(t,n,r){return n instanceof e?(r.x=t.x*n.x,r.y=t.y*n.y,r.z=t.z*n.z):(r.x=t.x*n,r.y=t.y*n,r.z=t.z*n),r},e.divide=function(t,n,r){return n instanceof e?(r.x=t.x/n.x,r.y=t.y/n.y,r.z=t.z/n.z):(r.x=t.x/n,r.y=t.y/n,r.z=t.z/n),r},e.cross=function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},e.unit=function(e,t){var n=e.length();return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},e.fromAngles=function(t,n){return new e(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))},e.randomDirection=function(){return e.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},e.min=function(t,n){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))},e.max=function(t,n){return new e(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))},e.lerp=function(e,t,n){return t.subtract(e).multiply(n).add(e)},e.fromArray=function(t){return new e(t[0],t[1],t[2])},e.angleBetween=function(e,t){return e.angleTo(t)},e}();window.Vector=e}(),function(){"use strict";var e=function(){var e=Math.PI/180;function t(t,n,r){var i=this;i.theta=(t||45)*e,i.phi=(n||45)*e,i.radius=r||1}return t.prototype={down:function(e,t){this.mouse={x:e,y:t}},move:function(t,n){var r=this,i=r.mouse;if(i){var o=180*(t-i.x)*e,s=180*(i.y-n)*e;i.x=t,i.y=n,r.theta+=o,r.phi+=s}},up:function(e,t){this.mouse=null},wheel:function(e){this.radius=Math.max(.01,this.radius+.02*e)},render:function(e){var n=t.toVector(this),r=new Float32Array([n.x,n.y,n.z]);this.update(e,"3fv","vec3","u_camera",r)},update:function(e,t,n,r,i){try{var o=e.uniforms[r]=e.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+t,o.location=e.gl.getUniformLocation(e.program,r),e.gl[o.method].apply(e.gl,[o.location].concat(o.value))}catch(e){console.log("CameraService.update.error",e)}}},t.fromVector=function(e){var n=e.length(),r=Math.acos(e.y/n),i=Math.atan(e.x/e.z);return new t(r,i,n)},t.toVector=function(e){var t=Math.sin(e.phi)*e.radius,n=t*Math.sin(e.theta),r=Math.cos(e.phi)*e.radius,i=t*Math.cos(e.theta);return new Vector(n,r,i)},t}();window.CameraService=e}(),function(){"use strict";function e(){}e.prototype={set:function(e){this.canvas=e},snapshot:function(){var e=this;if(e.queue)return e.queue.promise;return e.queue={},e.queue.promise=new Promise((function(t,n){e.queue.resolve=t,e.queue.reject=n})),e.queue.promise},snapshotRender:function(){var e=this;if(e.queue){for(var t=e.canvas.toDataURL("image/png"),n=atob(t.slice(22)),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);var o=new Blob([r],{type:"image/png"});e.queue.resolve({blob:o,extension:".png"}),e.queue=null}},record:function(){var e=this;if("function"!=typeof window.MediaRecorder||!e.canvas||"function"!=typeof e.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(e.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var t={},n=[],r=e.canvas.captureStream(30),i={mimeType:"video/webm; codecs=vp9",audioBitsPerSecond:0,videoBitsPerSecond:10485760},o=new MediaRecorder(r,i);o.ondataavailable=function(o){if(o.data.size>0&&n.push(o.data),t.resolve){var s=new Blob(n,{type:i.mimeType});if(r)(r.getTracks()||[]).forEach((function(e){e.stop(),r.removeTrack(e)}));r=null,e.recorder=null,e.capture=null,t.resolve({blob:s,extension:".webm"})}},e.capture=t,e.recorder=o,o.start()}catch(t){return e.capture=null,e.recorder=null,console.log("error: Scene video capture failed",t),!1}return!0},stop:function(){var e=this;if(!e.capture)return console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({});return e.capture.promise=new Promise((function(t,n){e.capture.resolve=t,e.capture.reject=n})),e.recorder.stop(),e.capture.promise}},window.CaptureService=e}(),function(){"use strict";function e(){this.capturer=new CCapture({format:"webm",quality:90,framerate:60})}e.prototype={set:function(e){this.canvas=e},snapshot:function(){return null},snapshotRender:function(){this.capturer.capture(this.canvas)},record:function(){return this.capturer.start(),!0},stop:function(){var e=this.capturer;return new Promise((function(t,n){e.stop(),e.save((function(e){t({blob:e,extension:".webm"})}))}))}},window.CCaptureService=e}(),function(){"use strict";var e=function(){function e(e){var t={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]}[e.length],n={};return e.filter((function(e,r){n[t[r]]=e})),n}function t(e,t){var n={};return e.filter((function(e,r){n[t+r]=e})),n}function n(e){return function(t){return e[t]}}return{set:function(n){var r={};for(var i in n){var o=n[i];if(Array.isArray(o))if(o.length>1)switch(typeof o[0]){case"number":o.length<5&&(r[i]=e(o));break;case"boolean":r[i]=t(o,"bool_");break;case"string":r[i]=t(o,"texture_");break;case"object":r[i]=t(o,"struct_")}else o.length&&(r[i]=o[0]);else null!=o&&(r[i]=o)}return r},get:function(e){var t={};for(var r in e){var i=e[r];switch(typeof i){case"function":break;case"number":case"boolean":case"string":t[r]=i;break;default:var o=Object.keys(i);t[r]=o.map(n(i))}}return t}}}(),t=function(){function t(e){this.closed=!0,this.hidden=!0,this.callback=e||function(){console.log("GuiService.onChange")},this.pool={}}function n(e){return JSON.parse(JSON.stringify(e))}function r(e,t,n){var i,o=[];for(i in t)o.push(i);o.filter((function(o){var s=t[o];if("number"==typeof s)(i=e.add(t,o,0,1)).onChange(n);else if("object"==typeof s&&Object.keys(s).length>0){i=null,r(e.addFolder(o),s,n)}else(i=e.add(t,o)).onChange(n)}))}return t.prototype={load:function(t){var i=this,o=i.gui,s=i.locals,a=(c=t,u=s,JSON.stringify(c)!==JSON.stringify(u));var c,u;o&&a&&(i.closed=o.closed,o.destroy(),o=null);o||((o=new dat.GUI).closed=i.closed,i.gui=o,i.hidden?i.hide():i.show());if(a){s=n(t),i.locals=s;var l=e.set(t);l=function(e,t){function r(e,t){for(var n in e)t.hasOwnProperty(n)&&("number"==typeof e[n]?e[n]=t[n]:"object"==typeof e[n]&&Object.keys(e[n]).length>0&&r(e[n],t[n]))}e&&r(e=n(e),t);return e}(l,i.pool),i.pool=l;var d=function(){i.callback(l)};r(o,l,d),l.randomize=function(){!function(e,t,n){function r(e,t){for(var n in e.__controllers.filter((function(e){if("number"==typeof e.initialValue&&"number"==typeof e.__min&&"number"==typeof e.__max){var n=e.__min+(e.__max-e.__min)*Math.random();t[e.property]=n,e.updateDisplay()}})),e.__folders)r(e.__folders[n],t[n])}r(e,t),n()}(o,l,d)},o.add(l,"randomize")}else i.callback(i.pool)},hide:function(){this.hidden=!0;var e=this.gui;e&&(e.domElement.style.display="none")},show:function(){var e=this,t=e.locals,n=e.gui;n&&Object.keys(t).length&&(n.domElement.style.display="");e.hidden=!1},uniforms:function(){var t=this.pool;return e.get(t)}},t}();window.GuiService=t}(),function(){"use strict";var e=function(){function e(){var e=this;e.mouse=new Float32Array([0,0]),e.history=[],e.trails=new Array(10).fill(null).map((function(){return new Float32Array([0,0])}))}e.prototype={render:function(e){var t=this,n=t.trails,r=t.history,i=t.mouse,o=0,s=n.length,a=r.length?r[0]:i;for(;o<s;){var c=o>0?n[o-1]:a,u=n[o],l=1/(5+o);u[0]+=(c[0]-u[0])*l,u[1]+=(c[1]-u[1])*l,t.update(e,"2fv","vec2","u_trails["+o+"]",u),o++}r.length&&r.shift()},move:function(e,t){var n=this.mouse;n[0]=e,n[1]=t,this.push()},push:function(e,n,r){var i,o,s,a=null,c=0;r||(r={});var u=function(){c=!1===r.leading?0:t(),a=null,s=e.apply(i,o),a||(i=o=null)};return function(){var l=t();c||!1!==r.leading||(c=l);var d=n-(l-c);return i=this,o=arguments,d<=0||d>n?(a&&(clearTimeout(a),a=null),c=l,s=e.apply(i,o),a||(i=o=null)):a||!1===r.trailing||(a=setTimeout(u,d)),s}}((function(){this.history.push(new Float32Array(this.mouse))}),1e3/60),update:function(e,t,n,r,i){try{var o=e.uniforms[r]=e.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+t,o.location=e.gl.getUniformLocation(e.program,r),e.gl[o.method].apply(e.gl,[o.location].concat(o.value))}catch(e){console.log("TrailsService.update.error",e)}}};var t=Date.now||function(){return(new Date).getTime()};return e}();window.TrailsService=e}(),function(){"use strict";var e=acquireVsCodeApi();e.getState();function t(t){var n=window.options,r=document.querySelector(".errors"),i=[],o=[],s=[];t.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,(function(e,r,o,a){r=Number(r)-t.offset;var c='<li><span class="error" unselectable reveal-line="'+s.length+'"><span class="line">ERROR line '+r+'</span> <span class="value" title="'+o+'">'+o+'</span> <span class="text" title="'+a+'">'+a+"</span></span></li>";return i.push(c),s.push([n.uri,r,"ERROR ("+o+") "+a]),c})),t.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,(function(e,r,i,a){r=Number(r)-t.offset;var c='<li><span class="warning" unselectable reveal-line="'+s.length+'"><span class="line">WARN line '+r+'</span> <span class="text" title="'+a+'">'+a+"</span></span></li>";return o.push(c),s.push([n.uri,r,"ERROR ("+i+") "+a]),c}));var a='<div class="errors-content"><div class="title">glsl-canvas error</div><ul>';a+=i.join("\n"),a+=o.join("\n"),a+="</ul></div>",r.innerHTML=a,r.classList.add("active"),[].slice.call(document.querySelectorAll(".errors [reveal-line]")).forEach((function(t){var n=parseInt(t.getAttribute("reveal-line"));t.addEventListener("click",(function(t){var r;r=s[n],e.postMessage({command:"revealGlslLine",data:JSON.stringify(r)}),t.preventDefault(),t.stopPropagation()}))})),document.querySelector("body").setAttribute("class","idle")}function n(t){e.postMessage({command:"textureError",data:JSON.stringify(t)})}window.addEventListener("load",(function(){var r,i,o=document.querySelector("body"),s=document.querySelector(".content"),a=document.querySelector(".shader"),c=document.querySelector(".errors"),u=document.querySelector(".welcome"),l=document.querySelector(".missing"),d={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),export:document.querySelector(".btn-export"),create:document.querySelector(".btn-create"),mode:document.querySelector(".btn-mode")},f=Array.prototype.slice.call(d.mode.querySelectorAll("li")),h={toggle:!1,record:!1,stats:!1,mode:"flat"};b();var p=new glsl.Canvas(a,{backgroundColor:"rgba(0.0, 0.0, 0.0, 0.0)",alpha:!0,antialias:window.options.antialias,premultipliedAlpha:!1,preserveDrawingBuffer:!1,workpath:window.options.workpath,mesh:window.options.resources+"/model/duck-toy.obj",extensions:window.options.extensions,doubleSided:window.options.doubleSided});p.on("load",(function(){var e=window.options;g.load(e.uniforms),p.setUniforms(g.uniforms()),c.classList.remove("active"),e.uri?u.classList.remove("active"):u.classList.add("active");h.pause?p.pause():p.play();t=p.canvas,a!==t&&(a.removeEventListener("dblclick",z),a.removeEventListener("mousemove",C),a=t,_());var t})),p.on("error",t),p.on("textureError",n);var m="CCapture"===window.options.recordMethod?new CCaptureService:new CaptureService;m.set(a);var v=new TrailsService;function y(e){var t=g.uniforms();p.setUniforms(t)}p.on("render",(function(){h.stats&&r.end(),h.record&&m.snapshotRender(),v.render(p),h.stats&&r.begin()}));var w,g=new GuiService(y);function x(){var t=window.options;for(var n in t.vertex=t.vertex.trim().length>0?t.vertex:null,t.fragment=t.fragment.trim().length>0?t.fragment:null,t.fragment||t.vertex?(o.classList.remove("idle","empty"),o.classList.add("ready")):(o.classList.remove("idle","ready"),o.classList.add("empty"),A()),t.textures)p.setTexture("u_texture_"+n,t.textures[n],{filtering:"mipmap",repeat:!0});p.load(t.fragment,t.vertex).then((e=>{l.classList.remove("active")}),(t=>{l.classList.add("active"),function(t){e.postMessage({command:"loadError",data:JSON.stringify({message:String(t)})})}(t)}))}function b(){var e=s.offsetWidth,t=s.offsetHeight;a.style.width=e+"px",a.style.height=t+"px"}function z(){h.pause?(h.pause=!1,p.play(),d.pause.querySelector("i").setAttribute("class","icon-pause")):(h.pause=!0,p.pause(),d.pause.querySelector("i").setAttribute("class","icon-play"))}function S(){h.record=!h.record,h.record?(o.classList.add("recording"),d.record.setAttribute("class","btn btn-record active"),d.record.querySelector("i").setAttribute("class","icon-stop"),function(){window.options.recordWidth>0&&window.options.recordHeight>0&&(s.style.width=window.options.recordWidth+"px",s.style.height=window.options.recordHeight+"px"),b(),p.forceRender=!0,p.render(),m.record();const e=window.options.recordDuration;window.rdt=e,o.style.setProperty("--record-duration",window.rdt),window.rii=setInterval((function(){e>0?(window.rdt--,o.style.setProperty("--record-duration",window.rdt),0===window.rdt&&M()):(window.rdt++,o.style.setProperty("--record-duration",window.rdt))}),1e3)}()):M()}function M(){window.rii&&clearInterval(window.rii),h.record=!1,o.classList.remove("recording"),d.record.setAttribute("class","btn btn-record"),d.record.querySelector("i").setAttribute("class","icon-record"),window.rii&&(clearInterval(window.rii),window.rii=null),m.stop().then((function(e){s.style.width="",s.style.height="",b();var t=URL.createObjectURL(e.blob),n=document.createElement("a");n.href=t,n.download="shader"+e.extension,n.click(),setTimeout((function(){window.URL.revokeObjectURL(t)}),100)}))}function L(){h.stats=!h.stats,h.stats?(i?i.style.visibility="visible":((r=new Stats).showPanel(0),(i=r.dom).setAttribute("class","stats"),document.body.appendChild(r.dom)),g.show(),d.stats.setAttribute("class","btn btn-stats active")):A()}function A(){i&&(i.style.visibility="hidden"),g.hide(),d.stats.setAttribute("class","btn btn-stats"),h.stats=!1}function q(t){window.options.mode=p.mode,e.postMessage({command:"onExport",data:JSON.stringify(window.options)})}function E(t){e.postMessage({command:"createShader",data:null})}function R(t){window.options=JSON.parse(t.data),e.setState(window.options),x()}function k(){w&&clearTimeout(w),w=setTimeout(b,50)}function C(e){v.move(e.x,s.offsetHeight-e.y)}function _(){a.addEventListener("dblclick",z),a.addEventListener("mousemove",C)}x(),d.pause.addEventListener("mousedown",z),d.record.addEventListener("mousedown",S),d.stats.addEventListener("mousedown",L),d.export.addEventListener("mousedown",q),d.create.addEventListener("click",E),d.mode.addEventListener("mouseenter",(function(){d.mode.classList.add("hover")})),d.mode.addEventListener("mouseleave",(function(){d.mode.classList.remove("hover")})),f.forEach((function(e){e.addEventListener("mousedown",(function(){f.forEach((function(t){t===e?t.classList.add("active"):t.classList.remove("active")}));var t,n=e.getAttribute("value");t=n,d.mode.firstElementChild.setAttribute("class","icon-"+t),h.mode=t,p.setMode(t)}))})),window.addEventListener("message",R,!1),window.addEventListener("resize",k),c.addEventListener("click",(function(){e.postMessage({command:"clearDiagnostic",data:null})})),_(),b(),e.setState(window.options)}))}();
//# sourceMappingURL=app.min.js.map