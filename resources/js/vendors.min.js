!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Stats=e()}(this,(function(){var t=function(){function e(t){return r.appendChild(t.dom),t}function n(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";i=t}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(t){t.preventDefault(),n(++i%r.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,u=e(new t.Panel("FPS","#0ff","#002")),l=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:r,addPanel:e,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(l.update(t-o,200),t>a+1e3&&(u.update(1e3*s/(t-a),100),a=t,s=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:r,setMode:n}};return t.Panel=function(t,e,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,u=48*a,l=3*a,c=2*a,h=3*a,d=15*a,f=74*a,p=30*a,m=document.createElement("canvas");m.width=s,m.height=u,m.style.cssText="width:80px;height:48px";var _=m.getContext("2d");return _.font="bold "+9*a+"px Helvetica,Arial,sans-serif",_.textBaseline="top",_.fillStyle=n,_.fillRect(0,0,s,u),_.fillStyle=e,_.fillText(t,l,c),_.fillRect(h,d,f,p),_.fillStyle=n,_.globalAlpha=.9,_.fillRect(h,d,f,p),{dom:m,update:function(u,v){i=Math.min(i,u),r=Math.max(r,u),_.fillStyle=n,_.globalAlpha=1,_.fillRect(0,0,s,d),_.fillStyle=e,_.fillText(o(u)+" "+t+" ("+o(i)+"-"+o(r)+")",l,c),_.drawImage(m,h+a,d,f-a,p,h,d,f-a,p),_.fillRect(h+f-a,d,a,p),_.fillStyle=n,_.globalAlpha=.9,_.fillRect(h+f-a,d,a,o((1-u/v)*p))}}},t})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.dat={})}(this,(function(t){"use strict";function e(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),r=Math.round(t.g),o=Math.round(t.b),a=t.a,s=Math.round(t.h),u=t.s.toFixed(1),l=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=t.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+i+","+r+","+o+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+o+","+a+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+o+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+",a:"+a+"}":"unknown format"}function n(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||B.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(B.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function i(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||B.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(B.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}function r(t){if("0"===t||x.isUndefined(t))return 0;var e=t.match(I);return x.isNull(e)?0:parseFloat(e[1])}function o(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}function a(t,e,n,i,r){return i+(t-e)/(n-e)*(r-i)}function s(t,e,n,i){t.style.background="",x.each(q,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}function u(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function l(t){N.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&N.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function c(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function h(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var r=n.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r),r[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[t.preset])a=o[t.preset];else{if(!o[$])return;a=o[$]}if(a[i]&&void 0!==a[i][e.property]){var s=a[i][e.property];e.initialValue=s,e.setValue(s)}}}}function d(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var r=void 0;if(i.color)r=new Y(e,n);else{var o=[e,n].concat(i.factoryArgs);r=J.apply(t,o)}i.before instanceof P&&(i.before=i.before.__li),h(t,r),N.addClass(r.domElement,"c");var a=document.createElement("span");N.addClass(a,"property-name"),a.innerHTML=r.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(r.domElement);var l=u(t,s,i.before);return N.addClass(l,at.CLASS_CONTROLLER_ROW),r instanceof Y?N.addClass(l,"color"):N.addClass(l,L(r.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,x.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),d(t,n.object,n.property,{before:i,factoryArgs:[x.toArray(arguments)]})}if(x.isArray(e)||x.isObject(e)){var r=n.__li.nextElementSibling;return n.remove(),d(t,n.object,n.property,{before:r,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof W){var i=new G(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});x.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],r=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(i,t),e.apply(n,t)}})),N.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof G){var r=function(e){if(x.isNumber(n.__min)&&x.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,r=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=d(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(i),r&&o.listen(),o}return e};n.min=x.compose(r,n.min),n.max=x.compose(r,n.max)}else n instanceof V?(N.bind(e,"click",(function(){N.fakeEvent(n.__checkbox,"click")})),N.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof X?(N.bind(e,"click",(function(){N.fakeEvent(n.__button,"click")})),N.bind(e,"mouseover",(function(){N.addClass(n.__button,"hover")})),N.bind(e,"mouseout",(function(){N.removeClass(n.__button,"hover")}))):n instanceof Y&&(N.addClass(e,"color"),n.updateDisplay=x.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=x.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&c(t.getRoot(),!0),e}),n.setValue)}(t,l,r),t.__controllers.push(r),r}function f(t,e){return document.location.href+"."+e}function p(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function m(t,e){e.style.display=t.useLocalStorage?"block":"none"}function _(t){var e=t.__save_row=document.createElement("li");N.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),N.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",N.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",N.addClass(i,"button"),N.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",N.addClass(r,"button"),N.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",N.addClass(o,"button"),N.addClass(o,"revert");var a=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?x.each(t.load.remembered,(function(e,n){p(t,n,n===t.preset)})):p(t,$,!1),N.bind(a,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(a),e.appendChild(n),e.appendChild(i),e.appendChild(r),e.appendChild(o),tt){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(f(0,"isLocal"))&&u.setAttribute("checked","checked"),m(t,s),N.bind(u,"change",(function(){t.useLocalStorage=!t.useLocalStorage,m(t,s)}))}var l=document.getElementById("dg-new-constructor");N.bind(l,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||et.hide()})),N.bind(n,"click",(function(){l.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),et.show(),l.focus(),l.select()})),N.bind(i,"click",(function(){t.save()})),N.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),N.bind(o,"click",(function(){t.revert()}))}function v(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function g(t,e){var n={};return x.each(t.__rememberedObjects,(function(i,r){var o={},a=t.__rememberedObjectIndecesToControllers[r];x.each(a,(function(t,n){o[n]=e?t.initialValue:t.getValue()})),n[r]=o})),n}function y(t){0!==t.length&&Q.call(window,(function(){y(t)})),x.each(t,(function(t){t.updateDisplay()}))}var b=Array.prototype.forEach,w=Array.prototype.slice,x={BREAK:{},extend:function(t){return this.each(w.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(w.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=w.call(arguments);return function(){for(var e=w.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(b&&t.forEach&&t.forEach===b)t.forEach(e,n);else if(t.length===t.length+0){var i,r=void 0;for(r=0,i=t.length;r<i;r++)if(r in t&&e.call(n,t[r],r)===this.BREAK)return}else for(var o in t)if(e.call(n,t[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var r=this,o=arguments,a=n||!i;clearTimeout(i),i=setTimeout((function(){i=null,n||t.apply(r,o)}),e),a&&t.apply(r,o)}},toArray:function(t){return t.toArray?t.toArray():w.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},E=[{litmus:x.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:e},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:x.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:x.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:x.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(x.isNumber(t.r)&&x.isNumber(t.g)&&x.isNumber(t.b)&&x.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(x.isNumber(t.r)&&x.isNumber(t.g)&&x.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(x.isNumber(t.h)&&x.isNumber(t.s)&&x.isNumber(t.v)&&x.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(x.isNumber(t.h)&&x.isNumber(t.s)&&x.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],T=void 0,A=void 0,U=function(){A=!1;var t=arguments.length>1?x.toArray(arguments):arguments[0];return x.each(E,(function(e){if(e.litmus(t))return x.each(e.conversions,(function(e,n){if(T=e.read(t),!1===A&&!1!==T)return A=T,T.conversionName=n,T.conversion=e,x.BREAK})),x.BREAK})),A},M=void 0,S={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),o=n*(1-e),a=n*(1-r*e),s=n*(1-(1-r)*e),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][i];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),r=Math.max(t,e,n),o=r-i,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=t===r?(e-n)/o:e===r?2+(n-t)/o:4+(t-e)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/r,v:r/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(M=8*e)|t&~(255<<M)}},L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},F=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),R=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},k=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},O=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},B=function(){function t(){if(C(this,t),this.__state=U.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return F(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();B.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=S.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");x.extend(t.__state,S.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},B.recalculateHSV=function(t){var e=S.rgb_to_hsv(t.r,t.g,t.b);x.extend(t.__state,{s:e.s,v:e.v}),x.isNaN(e.h)?x.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},B.COMPONENTS=["r","g","b","h","s","v","hex","a"],n(B.prototype,"r",2),n(B.prototype,"g",1),n(B.prototype,"b",0),i(B.prototype,"h"),i(B.prototype,"s"),i(B.prototype,"v"),Object.defineProperty(B.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(B.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=S.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var P=function(){function t(e,n){C(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return F(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),D={};x.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){x.each(t,(function(t){D[t]=e}))}));var I=/(\d+(\.\d+)?)px/,N={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,r=e;x.isUndefined(r)&&(r=!0),x.isUndefined(i)&&(i=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var r=n||{},o=D[e];if(!o)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":var s=r.x||r.clientX||0,u=r.y||r.clientY||0;a.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,s,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=a.initKeyboardEvent||a.initKeyEvent;x.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(e,r.bubbles||!1,r.cancelable||!0)}x.defaults(a,i),t.dispatchEvent(a)},bind:function(t,e,n,i){var r=i||!1;return t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on"+e,n),N},unbind:function(t,e,n,i){var r=i||!1;return t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on"+e,n),N},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return N},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return N},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return r(e["border-left-width"])+r(e["border-right-width"])+r(e["padding-left"])+r(e["padding-right"])+r(e.width)},getHeight:function(t){var e=getComputedStyle(t);return r(e["border-top-width"])+r(e["border-bottom-width"])+r(e["padding-top"])+r(e["padding-bottom"])+r(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},V=function(t){function e(t,n){C(this,e);var i=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),N.bind(i.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return k(e,P),F(e,[{key:"setValue",value:function(t){var n=R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),j=function(t){function e(t,n,i){C(this,e);var r=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i,a=r;if(r.__select=document.createElement("select"),x.isArray(o)){var s={};x.each(o,(function(t){s[t]=t})),o=s}return x.each(o,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),a.__select.appendChild(n)})),r.updateDisplay(),N.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;a.setValue(t)})),r.domElement.appendChild(r.__select),r}return k(e,P),F(e,[{key:"setValue",value:function(t){var n=R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return N.isActive(this.__select)?this:(this.__select.value=this.getValue(),R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),H=function(t){function e(t,n){function i(){o.setValue(o.__input.value)}C(this,e);var r=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r;return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),N.bind(r.__input,"keyup",i),N.bind(r.__input,"change",i),N.bind(r.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),N.bind(r.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return k(e,P),F(e,[{key:"updateDisplay",value:function(){return N.isActive(this.__input)||(this.__input.value=this.getValue()),R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),z=function(t){function e(t,n,i){C(this,e);var r=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=i||{};return r.__min=a.min,r.__max=a.max,r.__step=a.step,x.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=o(r.__impliedStep),r}return k(e,P),F(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=o(t),this}}]),e}(),G=function(t){function e(t,n,i){function r(){u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}function o(t){var e=l-t.clientY;u.setValue(u.getValue()+e*u.__impliedStep),l=t.clientY}function a(){N.unbind(window,"mousemove",o),N.unbind(window,"mouseup",a),r()}C(this,e);var s=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));s.__truncationSuspended=!1;var u=s,l=void 0;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),N.bind(s.__input,"change",(function(){var t=parseFloat(u.__input.value);x.isNaN(t)||u.setValue(t)})),N.bind(s.__input,"blur",(function(){r()})),N.bind(s.__input,"mousedown",(function(t){N.bind(window,"mousemove",o),N.bind(window,"mouseup",a),l=t.clientY})),N.bind(s.__input,"keydown",(function(t){13===t.keyCode&&(u.__truncationSuspended=!0,this.blur(),u.__truncationSuspended=!1,r())})),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return k(e,z),F(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}(this.getValue(),this.__precision),R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),W=function(t){function e(t,n,i,r,o){function s(t){t.preventDefault();var e=d.__background.getBoundingClientRect();return d.setValue(a(t.clientX,e.left,e.right,d.__min,d.__max)),!1}function u(){N.unbind(window,"mousemove",s),N.unbind(window,"mouseup",u),d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())}function l(t){var e=t.touches[0].clientX,n=d.__background.getBoundingClientRect();d.setValue(a(e,n.left,n.right,d.__min,d.__max))}function c(){N.unbind(window,"touchmove",l),N.unbind(window,"touchend",c),d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())}C(this,e);var h=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:r,step:o})),d=h;return h.__background=document.createElement("div"),h.__foreground=document.createElement("div"),N.bind(h.__background,"mousedown",(function(t){document.activeElement.blur(),N.bind(window,"mousemove",s),N.bind(window,"mouseup",u),s(t)})),N.bind(h.__background,"touchstart",(function(t){1===t.touches.length&&(N.bind(window,"touchmove",l),N.bind(window,"touchend",c),l(t))})),N.addClass(h.__background,"slider"),N.addClass(h.__foreground,"slider-fg"),h.updateDisplay(),h.__background.appendChild(h.__foreground),h.domElement.appendChild(h.__background),h}return k(e,z),F(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",R(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),X=function(t){function e(t,n,i){C(this,e);var r=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===i?"Fire":i,N.bind(r.__button,"click",(function(t){return t.preventDefault(),o.fire(),!1})),N.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return k(e,P),F(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),Y=function(t){function e(t,n){function i(t){c(t),N.bind(window,"mousemove",c),N.bind(window,"touchmove",c),N.bind(window,"mouseup",o),N.bind(window,"touchend",o)}function r(t){h(t),N.bind(window,"mousemove",h),N.bind(window,"touchmove",h),N.bind(window,"mouseup",a),N.bind(window,"touchend",a)}function o(){N.unbind(window,"mousemove",c),N.unbind(window,"touchmove",c),N.unbind(window,"mouseup",o),N.unbind(window,"touchend",o),l()}function a(){N.unbind(window,"mousemove",h),N.unbind(window,"touchmove",h),N.unbind(window,"mouseup",a),N.unbind(window,"touchend",a),l()}function u(){var t=U(this.value);!1!==t?(f.__color.__state=t,f.setValue(f.__color.toOriginal())):this.value=f.__color.toString()}function l(){f.__onFinishChange&&f.__onFinishChange.call(f,f.__color.toOriginal())}function c(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=f.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,r=n.clientY,o=(i-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),o>1?o=1:o<0&&(o=0),f.__color.v=a,f.__color.s=o,f.setValue(f.__color.toOriginal()),!1}function h(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=f.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),f.__color.h=360*n,f.setValue(f.__color.toOriginal()),!1}C(this,e);var d=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));d.__color=new B(d.getValue()),d.__temp=new B(0);var f=d;d.domElement=document.createElement("div"),N.makeSelectable(d.domElement,!1),d.__selector=document.createElement("div"),d.__selector.className="selector",d.__saturation_field=document.createElement("div"),d.__saturation_field.className="saturation-field",d.__field_knob=document.createElement("div"),d.__field_knob.className="field-knob",d.__field_knob_border="2px solid ",d.__hue_knob=document.createElement("div"),d.__hue_knob.className="hue-knob",d.__hue_field=document.createElement("div"),d.__hue_field.className="hue-field",d.__input=document.createElement("input"),d.__input.type="text",d.__input_textShadow="0 1px 1px ",N.bind(d.__input,"keydown",(function(t){13===t.keyCode&&u.call(this)})),N.bind(d.__input,"blur",u),N.bind(d.__selector,"mousedown",(function(){N.addClass(this,"drag").bind(window,"mouseup",(function(){N.removeClass(f.__selector,"drag")}))})),N.bind(d.__selector,"touchstart",(function(){N.addClass(this,"drag").bind(window,"touchend",(function(){N.removeClass(f.__selector,"drag")}))}));var p=document.createElement("div");return x.extend(d.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),x.extend(d.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:d.__field_knob_border+(d.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),x.extend(d.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),x.extend(d.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),x.extend(p.style,{width:"100%",height:"100%",background:"none"}),s(p,"top","rgba(0,0,0,0)","#000"),x.extend(d.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(d.__hue_field),x.extend(d.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:d.__input_textShadow+"rgba(0,0,0,0.7)"}),N.bind(d.__saturation_field,"mousedown",i),N.bind(d.__saturation_field,"touchstart",i),N.bind(d.__field_knob,"mousedown",i),N.bind(d.__field_knob,"touchstart",i),N.bind(d.__hue_field,"mousedown",r),N.bind(d.__hue_field,"touchstart",r),d.__saturation_field.appendChild(p),d.__selector.appendChild(d.__field_knob),d.__selector.appendChild(d.__saturation_field),d.__selector.appendChild(d.__hue_field),d.__hue_field.appendChild(d.__hue_knob),d.domElement.appendChild(d.__input),d.domElement.appendChild(d.__selector),d.updateDisplay(),d}return k(e,P),F(e,[{key:"updateDisplay",value:function(){var t=U(this.getValue());if(!1!==t){var e=!1;x.each(B.COMPONENTS,(function(n){if(!x.isUndefined(t[n])&&!x.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&x.extend(this.__color.__state,t)}x.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;x.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),x.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(),q=["-moz-","-o-","-webkit-","-ms-",""],K=function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var r=n.getElementsByTagName("head")[0];try{r.appendChild(i)}catch(t){}},J=function(t,e){var n=t[e];return x.isArray(arguments[2])||x.isObject(arguments[2])?new j(t,e,arguments[2]):x.isNumber(n)?x.isNumber(arguments[2])&&x.isNumber(arguments[3])?x.isNumber(arguments[4])?new W(t,e,arguments[2],arguments[3],arguments[4]):new W(t,e,arguments[2],arguments[3]):x.isNumber(arguments[4])?new G(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new G(t,e,{min:arguments[2],max:arguments[3]}):x.isString(n)?new H(t,e):x.isFunction(n)?new X(t,e,""):x.isBoolean(n)?new V(t,e):null},Q=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},Z=function(){function t(){C(this,t),this.backgroundElement=document.createElement("div"),x.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),N.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),x.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;N.bind(this.backgroundElement,"click",(function(){e.hide()}))}return F(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),x.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",N.unbind(t.domElement,"webkitTransitionEnd",e),N.unbind(t.domElement,"transitionend",e),N.unbind(t.domElement,"oTransitionEnd",e)};N.bind(this.domElement,"webkitTransitionEnd",e),N.bind(this.domElement,"transitionend",e),N.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-N.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-N.getHeight(this.domElement)/2+"px"}}]),t}();K(function(t){if("undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var $="Default",tt=function(){try{return!!window.localStorage}catch(t){return!1}}(),et=void 0,nt=!0,it=void 0,rt=!1,ot=[],at=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),N.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=x.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=x.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),x.isUndefined(i.load)?i.load={preset:$}:i.preset&&(i.load.preset=i.preset),x.isUndefined(i.parent)&&i.hideable&&ot.push(this),i.resizable=x.isUndefined(i.parent)&&i.resizable,i.autoPlace&&x.isUndefined(i.scrollable)&&(i.scrollable=!0);var r=tt&&"true"===localStorage.getItem(f(0,"isLocal")),o=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,v(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?N.addClass(n.__ul,t.CLASS_CLOSED):N.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(t){tt&&(r=t,t?N.bind(window,"unload",o):N.unbind(window,"unload",o),localStorage.setItem(f(0,"isLocal"),t))}}}),x.isUndefined(i.parent)){if(this.closed=i.closed||!1,N.addClass(this.domElement,t.CLASS_MAIN),N.makeSelectable(this.domElement,!1),tt&&r){n.useLocalStorage=!0;var s=localStorage.getItem(f(0,"gui"));s&&(i.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,N.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(N.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(N.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),N.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var l=document.createTextNode(i.name);N.addClass(l,"controller-name"),a=u(n,l),N.addClass(this.__ul,t.CLASS_CLOSED),N.addClass(a,"title"),N.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(x.isUndefined(i.parent)&&(nt&&(it=document.createElement("div"),N.addClass(it,"dg"),N.addClass(it,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(it),nt=!1),it.appendChild(this.domElement),N.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||v(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},N.bind(window,"resize",this.__resizeHandler),N.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),N.bind(this.__ul,"transitionend",this.__resizeHandler),N.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&function(t){function e(e){return e.preventDefault(),t.width+=r-e.clientX,t.onResize(),r=e.clientX,!1}function n(){N.removeClass(t.__closeButton,at.CLASS_DRAG),N.unbind(window,"mousemove",e),N.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),r=i.clientX,N.addClass(t.__closeButton,at.CLASS_DRAG),N.bind(window,"mousemove",e),N.bind(window,"mouseup",n),!1}var r=void 0;t.__resize_handle=document.createElement("div"),x.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),N.bind(t.__resize_handle,"mousedown",i),N.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this),o=function(){tt&&"true"===localStorage.getItem(f(0,"isLocal"))&&localStorage.setItem(f(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,i.parent||function(){var t=n.getRoot();t.width+=1,x.defer((function(){t.width-=1}))}()};at.toggleHide=function(){rt=!rt,x.each(ot,(function(t){t.domElement.style.display=rt?"none":""}))},at.CLASS_AUTO_PLACE="a",at.CLASS_AUTO_PLACE_CONTAINER="ac",at.CLASS_MAIN="main",at.CLASS_CONTROLLER_ROW="cr",at.CLASS_TOO_TALL="taller-than-window",at.CLASS_CLOSED="closed",at.CLASS_CLOSE_BUTTON="close-button",at.CLASS_CLOSE_TOP="close-top",at.CLASS_CLOSE_BOTTOM="close-bottom",at.CLASS_DRAG="drag",at.DEFAULT_WIDTH=245,at.TEXT_CLOSED="Close Controls",at.TEXT_OPEN="Open Controls",at._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||at.toggleHide()},N.bind(window,"keydown",at._keydownHandler,!1),x.extend(at.prototype,{add:function(t,e){return d(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return d(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;x.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&it.removeChild(this.domElement);var t=this;x.each(this.__folders,(function(e){t.removeFolder(e)})),N.unbind(window,"keydown",at._keydownHandler,!1),l(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new at(e);this.__folders[t]=n;var i=u(this,n.domElement);return N.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],l(t);var e=this;x.each(t.__folders,(function(e){t.removeFolder(e)})),x.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=N.getOffset(t.__ul).top,n=0;x.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=N.getHeight(e))})),window.innerHeight-e-20<n?(N.addClass(t.domElement,at.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(N.removeClass(t.domElement,at.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&x.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:x.debounce((function(){this.onResize()}),50),remember:function(){if(x.isUndefined(et)&&((et=new Z).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;x.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&_(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&v(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=g(this)),t.folders={},x.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=g(this),c(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[$]=g(this,!0)),this.load.remembered[t]=g(this),this.preset=t,p(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){x.each(this.__controllers,(function(e){this.getRoot().load.remembered?h(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),x.each(this.__folders,(function(t){t.revert(t)})),t||c(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&y(this.__listening)},updateDisplay:function(){x.each(this.__controllers,(function(t){t.updateDisplay()})),x.each(this.__folders,(function(t){t.updateDisplay()}))}});var st={Color:B,math:S,interpret:U},ut={Controller:P,BooleanController:V,OptionController:j,StringController:H,NumberController:z,NumberControllerBox:G,NumberControllerSlider:W,FunctionController:X,ColorController:Y},lt={dom:N},ct={GUI:at},ht=at,dt={color:st,controllers:ut,dom:lt,gui:ct,GUI:ht};t.color=st,t.controllers=ut,t.dom=lt,t.gui=ct,t.GUI=ht,t.default=dt,Object.defineProperty(t,"__esModule",{value:!0})})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).glsl={})}(this,(function(t){"use strict";function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var o="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec4 a_position;\nattribute vec4 a_normal;\nattribute vec2 a_texcoord;\nattribute vec4 a_color;\n\nvarying vec4 v_position;\nvarying vec4 v_normal;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n",a="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec4 v_position;\nvarying vec4 v_normal;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n",s="#version 300 es\n\nprecision mediump float;\n\nin vec4 a_position;\nin vec4 a_normal;\nin vec2 a_texcoord;\nin vec4 a_color;\n\nout vec4 v_position;\nout vec4 v_normal;\nout vec2 v_texcoord;\nout vec4 v_color;\n",u="#version 300 es\n\nprecision mediump float;\n\nin vec4 v_position;\nin vec4 v_normal;\nin vec2 v_texcoord;\nin vec4 v_color;\n\nout vec4 outColor;\n",l="\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_normalMatrix;\n\nuniform vec2 u_resolution;\nuniform float u_time;\n",c="\nvoid main() {\n\tv_position = a_position;\n\tv_normal = a_normal;\n\tv_texcoord = a_texcoord;\n\tv_color = a_color;\n\tgl_Position = a_position;\n}\n",h="\nvoid main(void) {\n\tv_position = u_projectionMatrix * u_modelViewMatrix * a_position;\n\tv_normal = u_normalMatrix * a_normal;\n\tv_texcoord = a_texcoord;\n\tv_color = a_color;\n\tgl_Position = v_position;\n}\n",d=o+l+h,f=s+l+h,p=a+l+"\nvoid main() {\n\tvec2 st = gl_FragCoord.xy / u_resolution.xy;\n\tst.x *= u_resolution.x / u_resolution.y;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * st.y,\n\t\tabs(cos(u_time * 0.2)) * st.y,\n\t\tabs(sin(u_time)) * st.y\n\t);\n\tgl_FragColor = vec4(color, 1.0);\n}\n",m=u+l+"\nvoid main() {\n\tvec2 st = gl_FragCoord.xy / u_resolution.xy;\n\tst.x *= u_resolution.x / u_resolution.y;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * st.y,\n\t\tabs(cos(u_time * 0.2)) * st.y,\n\t\tabs(sin(u_time)) * st.y\n\t);\n\toutColor = vec4(color, 1.0);\n}\n",_=a+l+"\nvoid main() {\n\tvec2 uv = v_texcoord;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * uv.y,\n\t\tabs(cos(u_time * 0.2)) * uv.y,\n\t\tabs(sin(u_time)) * uv.y\n\t);\n\tfloat incidence = max(dot(v_normal.xyz, vec3(0.0, 1.0, 0.0)), 0.0);\n\tvec3 light = vec3(0.2) + (vec3(1.0) * incidence);\n\tgl_FragColor = vec4(v_color.rgb * color * light, 1.0);\n}\n",v=u+l+"\nvoid main() {\n\tvec2 uv = v_texcoord;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * uv.y,\n\t\tabs(cos(u_time * 0.2)) * uv.y,\n\t\tabs(sin(u_time)) * uv.y\n\t);\n\tfloat incidence = max(dot(v_normal.xyz, vec3(0.0, 1.0, 0.0)), 0.0);\n\tvec3 light = vec3(0.2) + (vec3(1.0) * incidence);\n\toutColor = vec4(v_color.rgb * color * light, 1.0);\n}\n",g=o+l+c,y=s+l+c,b=a+l+"\nvoid main(){\n\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}",w=u+l+"\nvoid main() {\n\toutColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n",x=setTimeout;function E(t){return Boolean(t&&void 0!==t.length)}function T(){}function A(t){if(!(this instanceof A))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],F(t,this)}function U(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,A._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var i;try{i=n(t._value)}catch(t){return void S(e.promise,t)}M(e.promise,i)}else(1===t._state?M:S)(e.promise,t._value)}))):t._deferreds.push(e)}function M(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof A)return t._state=3,t._value=e,void L(t);if("function"==typeof n)return void F((i=n,r=e,function(){i.apply(r,arguments)}),t)}t._state=1,t._value=e,L(t)}catch(e){S(t,e)}var i,r}function S(t,e){t._state=2,t._value=e,L(t)}function L(t){2===t._state&&0===t._deferreds.length&&A._immediateFn((function(){t._handled||A._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)U(t,t._deferreds[e]);t._deferreds=null}function C(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function F(t,e){var n=!1;try{t((function(t){n||(n=!0,M(e,t))}),(function(t){n||(n=!0,S(e,t))}))}catch(t){if(n)return;n=!0,S(e,t)}}A.prototype.catch=function(t){return this.then(null,t)},A.prototype.then=function(t,e){var n=new this.constructor(T);return U(this,new C(t,e,n)),n},A.prototype.finally=function(t){var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){return e.reject(n)}))}))},A.all=function(t){return new A((function(e,n){if(!E(t))return n(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var r=i.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,(function(e){o(t,e)}),n)}i[t]=a,0==--r&&e(i)}catch(t){n(t)}}for(var a=0;a<i.length;a++)o(a,i[a])}))},A.allSettled=function(t){return new this((function(e,n){if(!t||void 0===t.length)return n(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var r=i.length;function o(t,n){if(n&&("object"==typeof n||"function"==typeof n)){var a=n.then;if("function"==typeof a)return void a.call(n,(function(e){o(t,e)}),(function(n){i[t]={status:"rejected",reason:n},0==--r&&e(i)}))}i[t]={status:"fulfilled",value:n},0==--r&&e(i)}for(var a=0;a<i.length;a++)o(a,i[a])}))},A.resolve=function(t){return t&&"object"==typeof t&&t.constructor===A?t:new A((function(e){e(t)}))},A.reject=function(t){return new A((function(e,n){n(t)}))},A.race=function(t){return new A((function(e,n){if(!E(t))return n(new TypeError("Promise.race accepts an array"));for(var i=0,r=t.length;i<r;i++)A.resolve(t[i]).then(e,n)}))},A._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){x(t,0)},A._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var R,k=function(){function t(){}return t.fetch=function(t){return new Promise((function(e,n){var i=new XMLHttpRequest;i.onload=function(){e(i.response||i.responseText)},i.onerror=function(e){console.log("Common.error",e),n(new Error("Network request failed for url "+t))},i.ontimeout=function(e){n(new Error("Network request failed for url "+t))},i.onabort=function(){n(new Error("Aborted"))},i.open("GET",t,!0),i.send(null)}))},t.getResource=function(e,n){return void 0===n&&(n=""),-1===e.indexOf(":/")?t.join(n,e):e},t.join=function(){for(var e=[],n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return i.forEach((function(n){0===n.indexOf("/")&&(e=[]),t.comps(n).forEach((function(t){switch(t){case".":break;case"..":e.pop();break;default:e.push(t)}}))})),e.join("/")},t.dirname=function(e){var n=t.comps(e);return n.pop(),n.join("/")},t.comps=function(t){return t.replace(/\/$/,"").split(/\/+/)},t}();!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Log=3]="Log"}(R||(R={}));var O,B,P,D=function(){function t(){}return t.log=function(){var e;t.enabled&&t.level>=R.Log&&(e=console).log.apply(e,arguments)},t.warn=function(){var e;t.enabled&&t.level>=R.Warn&&(e=console).warn.apply(e,arguments)},t.error=function(){var e;t.enabled&&t.level>=R.Error&&(e=console).error.apply(e,arguments)},t}();D.level=R.Warn,D.enabled=!0,(O=t.ContextVersion||(t.ContextVersion={})).WebGl="webgl",O.WebGl2="webgl2",function(t){t.LowP="lowp",t.MediumP="mediump",t.HighP="highp"}(B||(B={})),function(t){t.Flat="flat",t.Box="box",t.Sphere="sphere",t.Torus="torus",t.Mesh="mesh"}(P||(P={}));var I,N={webgl:{flat:{vertex:d,fragment:p},mesh:{vertex:d,fragment:_}},webgl2:{flat:{vertex:f,fragment:m},mesh:{vertex:f,fragment:v}}};(I=t.ContextError||(t.ContextError={}))[I.BrowserSupport=1]="BrowserSupport",I[I.Other=2]="Other";var V=function(){},j=function(){function e(){}return e.getContext_=function(t,e){for(var n=["webgl","experimental-webgl"],i=null,r=0;r<n.length;++r)try{i=t.getContext(n[r],e)}catch(t){if(i)break}return i},e.getContext2_=function(t,e){var n=null;try{n=t.getContext("webgl2",e)}catch(t){}return n},e.getFragmentVertex=function(n,i){var r;if(i){var o=e.inferVersion(i);o===t.ContextVersion.WebGl2&&(i=i.replace(/^\#version\s*300\s*es.*?\n/,"")),null!==/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*VERTEX)(?:\s*\))|(?:#ifdef)(?:\s*VERTEX)(?:\s*))/gm.exec(i)&&(r=o===t.ContextVersion.WebGl2?"#version 300 es\n#define VERTEX\n"+i:"#define VERTEX\n"+i)}return r},e.getIncludes=function(t,n){if(void 0===n&&(n=""),void 0===t)return Promise.resolve(t);for(var i,r=/#include\s*['|"](.*.glsl)['|"]/gm,o=[],a=0,s=function(){o.push(Promise.resolve(t.slice(a,i.index))),a=i.index+i[0].length;var r=i[1],s=k.getResource(r,n),u=-1===r.indexOf(":/")?k.dirname(s):"";o.push(k.fetch(s).then((function(t){return e.getIncludes(t,u)})))};null!==(i=r.exec(t));)s();return o.push(Promise.resolve(t.slice(a))),Promise.all(o).then((function(t){return t.join("")}))},e.isWebGl=function(t){return t instanceof WebGLRenderingContext},e.isWebGl2=function(t){return window.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext},e.inferVersion=function(e,n){var i=e||n;return i&&0===i.indexOf("#version 300 es")?t.ContextVersion.WebGl2:t.ContextVersion.WebGl},e.inferPrecision=function(t){var n=t.match(/precision\s+(.+)\s+float/);return n&&n.length>1&&(e.precision=n[1]),e.precision},e.versionDiffers=function(n,i,r){if(n){var o=this.isWebGl2(n)?t.ContextVersion.WebGl2:t.ContextVersion.WebGl;return e.inferVersion(i,r)!==o}return!1},e.getBufferVertex=function(t){return this.isWebGl2(t)?y:g},e.getVertex=function(t,e,n){if(void 0===n&&(n=P.Flat),t)return t;var i=this.inferVersion(t,e);return N[i][n===P.Flat?"flat":"mesh"].vertex},e.getFragment=function(t,e,n){if(void 0===n&&(n=P.Flat),e)return e;var i=this.inferVersion(t,e);return N[i][n===P.Flat?"flat":"mesh"].fragment},e.tryInferContext=function(n,i,r,o,a,s){function u(t,e){if("function"==typeof s)s(t);else{var n=r.parentNode;n&&(n.innerHTML='<div class="glsl-canvas--error">'+e+"</div>")}}if(void 0===a&&(a=[]),!WebGLRenderingContext)return u(t.ContextError.BrowserSupport,'This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var l=e.inferContext(n,i,r,o);if(l){this.isWebGl2(l)||-1!==a.indexOf("OES_standard_derivatives")||a.push("OES_standard_derivatives");var c=l.getSupportedExtensions();a.forEach((function(t){-1!==c.indexOf(t)?l.getExtension(t):D.warn("GlslCanvas "+t+" not supported")}))}else u(t.ContextError.Other,'It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>');return l},e.tryGetContext=function(n,i,r){function o(t,e){if("function"==typeof r)r(t);else{var i=n.parentNode;i&&(i.innerHTML='<div class="glsl-canvas--error">'+e+"</div>")}}if(!WebGLRenderingContext)return o(t.ContextError.BrowserSupport,'This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var a=e.getContext_(n,i);return a?a.getExtension("OES_standard_derivatives"):o(t.ContextError.Other,'It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),a},e.inferContext=function(e,n,i,r){return this.inferVersion(e,n)===t.ContextVersion.WebGl2?this.getContext2_(i,r):this.getContext_(i,r)},e.createShader=function(t,n,i,r){void 0===r&&(r=0);var o=t.createShader(i);if(n=n.replace(/precision\s+(.+)\s+float/,"precision "+e.precision+" float"),t.shaderSource(o,n),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw e.lastError=t.getShaderInfoLog(o),D.error("*** Error compiling shader: "+e.lastError),t.deleteShader(o),{shader:o,source:n,type:i,error:e.lastError,offset:r};return o},e.createProgram=function(t,n,i,r){for(var o=t.createProgram(),a=0;a<n.length;++a)t.attachShader(o,n[a]);if(i&&r)for(var s=0;s<i.length;++s)t.bindAttribLocation(o,r?r[s]:s,i[s]);return t.linkProgram(o),t.validateProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?(t.useProgram(o),o):(e.lastError=t.getProgramInfoLog(o),D.error("Error in program linking: "+e.lastError),t.deleteProgram(o),null)},e.createVertexBuffers=function(t,e){var n=new V,i=t.getAttribLocation(e,"a_texcoord");n.texcoord=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.texcoord),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0);var r=t.getAttribLocation(e,"a_position");return n.position=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.position),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),n},e}();j.precision=B.MediumP,j.lastError="";var H,z=function(){},G=function(){function t(){this.values=new z}var e=t.prototype;return e.has=function(t){return t in this.values},e.set=function(t,e){this.values[t]=e},e.get=function(t){return this.values[t]},e.forEach=function(t){var e=this,n=0;Object.keys(this.values).forEach((function(i){t(e.values[i],n,e.values),n++}))},e.reduce=function(t,e){var n=this,i=e,r=0;return Object.keys(this.values).forEach((function(e){i=t(i,n.values[e],r,n.values),r++})),i},t}(),W=function(){function t(t){t&&(Object.assign(this,t),this.positions&&(this.size=this.positions.length/3))}var e=t.prototype;return e.create=function(t,e){this.createData_(),this.createAttributes_(t,e)},e.createBufferData_=function(t,e,n){var i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,t.STATIC_DRAW),i},e.createAttribLocation_=function(t,e,n,i,r){var o=t.getAttribLocation(e,n);return t.enableVertexAttribArray(o),t.vertexAttribPointer(o,i,r,!1,0,0),o},e.createAttributes_=function(t,e){this.positions&&(this.positionBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.positions)),this.positionLocation=this.createAttribLocation_(t,e,"a_position",this.positions.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.positionLocation,"a_position")),this.texcoords&&(this.texcoordBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.texcoords)),this.texcoordLocation=this.createAttribLocation_(t,e,"a_texcoord",this.texcoords.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.texcoordLocation,"a_texcoord")),this.normals&&(this.normalBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.normals)),this.normalLocation=this.createAttribLocation_(t,e,"a_normal",this.normals.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.normalLocation,"a_normal")),this.colors&&(this.colorBuffer=this.createBufferData_(t,t.ARRAY_BUFFER,new Float32Array(this.colors)),this.colorLocation=this.createAttribLocation_(t,e,"a_color",this.colors.length/this.size,t.FLOAT),t.bindAttribLocation(e,this.colorLocation,"a_color"))},e.attachAttributes_=function(t,e){var n;this.positions&&(n=t.getAttribLocation(e,"a_position"),t.enableVertexAttribArray(n),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(n,this.positions.length/this.size,t.FLOAT,!1,0,0)),this.texcoords&&(n=t.getAttribLocation(e,"a_texcoord"),t.enableVertexAttribArray(this.texcoordLocation),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),t.vertexAttribPointer(this.texcoordLocation,this.texcoords.length/this.size,t.FLOAT,!1,0,0)),this.normals&&(n=t.getAttribLocation(e,"a_normal"),t.enableVertexAttribArray(this.normalLocation),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.vertexAttribPointer(this.normalLocation,this.normals.length/this.size,t.FLOAT,!1,0,0)),this.colors&&(n=t.getAttribLocation(e,"a_color"),t.enableVertexAttribArray(this.colorLocation),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.vertexAttribPointer(this.colorLocation,this.colors.length/this.size,t.FLOAT,!1,0,0))},e.bindAttributes_=function(t,e){this.positions&&t.bindAttribLocation(e,this.positionLocation,"a_position"),this.texcoords&&t.bindAttribLocation(e,this.texcoordLocation,"a_texcoord"),this.normals&&t.bindAttribLocation(e,this.normalLocation,"a_normal"),this.colors&&t.bindAttribLocation(e,this.colorLocation,"a_color")},e.createData_=function(){this.positions=[],this.normals=[],this.texcoords=[],this.colors=[],this.size=0},t.fromIndices=function(t,e,n){var i=[];return t.forEach((function(t){i.push.apply(i,e.slice(t*n,t*n+n))})),i},t}(),X=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.createData_=function(){this.size=6,this.positions=[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0],this.texcoords=[0,0,1,0,1,1,0,0,1,1,0,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],this.colors=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},e}(W);(H=t.BufferFloatType||(t.BufferFloatType={}))[H.FLOAT=0]="FLOAT",H[H.HALF_FLOAT=1]="HALF_FLOAT";var Y=function(){function e(t,n,i,r){var o=t.createFramebuffer(),a=e.getTexture(t,n,i,r);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.texture=a,this.buffer=o,this.BW=n,this.BH=i,this.index=r}return e.getFloatType=function(t){return j.isWebGl2(t)&&t.getExtension("EXT_color_buffer_float")||t.getExtension("OES_texture_float")?t.FLOAT:null},e.getHalfFloatType=function(t){var e;return j.isWebGl2(t)&&(e=t.getExtension("EXT_color_buffer_half_float")||t.getExtension("EXT_color_buffer_float"))?t.HALF_FLOAT:(e=t.getExtension("OES_texture_half_float"))&&e.HALF_FLOAT_OES||null},e.getInternalFormat=function(t){return j.isWebGl2(t)?t.RGBA16F:t.RGBA},e.getType=function(n){return e.type===t.BufferFloatType.HALF_FLOAT?e.getHalfFloatType(n)||(e.type=t.BufferFloatType.FLOAT,e.getType(n)):e.getFloatType(n)||(e.type=t.BufferFloatType.HALF_FLOAT,e.getType(n))},e.getTexture=function(n,i,r,o){var a=e.getInternalFormat(n),s=n.RGBA,u=e.getType(n),l=n.createTexture();return n.activeTexture(n.TEXTURE0+o),n.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,a,i,r,0,s,u,null),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE?(e.type===t.BufferFloatType.FLOAT?e.type=t.BufferFloatType.HALF_FLOAT:e.type=t.BufferFloatType.FLOAT,e.getTexture(n,i,r,o)):l},e.prototype.resize=function(t,n,i){if(n!==this.BW||i!==this.BH){var r=this.buffer,o=this.texture,a=this.index;t.bindFramebuffer(t.FRAMEBUFFER,r);var s,u=t.checkFramebufferStatus(t.FRAMEBUFFER),l=Math.min(n,this.BW),c=Math.min(i,this.BH),h=e.getType(t);u===t.FRAMEBUFFER_COMPLETE&&(s=new Float32Array(l*c*4),t.readPixels(0,0,l,c,t.RGBA,h,s)),t.bindFramebuffer(t.FRAMEBUFFER,null);var d=a+1,f=e.getTexture(t,n,i,d);h=e.getType(t),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s&&t.texSubImage2D(t.TEXTURE_2D,0,0,0,l,c,t.RGBA,h,s);var p=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(o),t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_2D,f),this.index=a,this.texture=f,this.buffer=p,this.BW=n,this.BH=i}},e}();Y.type=t.BufferFloatType.HALF_FLOAT;var q=function(){function t(t,e,n,i){this.isValid=!1,this.index=t,this.key=e,this.vertexString=n,this.fragmentString=i,this.geometry=new X}var e=t.prototype;return e.create=function(t,e,n){var i=j.createShader(t,this.vertexString,t.VERTEX_SHADER),r=j.createShader(t,this.fragmentString,t.FRAGMENT_SHADER,1);r?this.isValid=!0:(r=j.createShader(t,j.isWebGl2(t)?w:b,t.FRAGMENT_SHADER),this.isValid=!1);var o=j.createProgram(t,[i,r]);if(!o)return this.isValid=!1,t.deleteShader(i),void t.deleteShader(r);this.geometry.create(t,o),t.deleteShader(i),t.deleteShader(r);var a=new Y(t,e,n,this.index+0),s=new Y(t,e,n,this.index+2);this.program=o,this.input=a,this.output=s},e.render=function(t,e,n){t.useProgram(this.program),t.bindFramebuffer(t.FRAMEBUFFER,this.output.buffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.output.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE&&(t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)),t.viewport(0,0,e,n),t.drawArrays(t.TRIANGLES,0,this.geometry.size);var i=this.input;this.input=this.output,this.output=i},e.resize=function(t,e,n){t.useProgram(this.program),t.viewport(0,0,e,n),this.input.resize(t,e,n),this.output.resize(t,e,n)},e.destroy=function(t){t.deleteProgram(this.program),this.program=null,this.input=null,this.output=null},t}(),K=function(t){function i(){return t.apply(this,arguments)||this}var r,o;return n(i,t),i.getBuffers=function(t,e,n){var r=new i,o=0;if(e){j.isWebGl2(t)&&(e=e.replace(/^\#version\s*300\s*es\s*\n/,""));for(var a,s=/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm;null!==(a=s.exec(e));){var u=a[3]||a[4],l="u_buffer"+u,c=j.isWebGl2(t)?"#version 300 es\n#define BUFFER_"+u+"\n"+e:"#define BUFFER_"+u+"\n"+e,h=new q(o,l,n,c);if(h.create(t,t.drawingBufferWidth,t.drawingBufferHeight),!h.program)throw"buffer error "+l;r.set(l,h),o+=4}}return r},r=i,(o=[{key:"count",get:function(){return 4*Object.keys(this.values).length}}])&&e(r.prototype,o),i}(G),J=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.isVector2=!0,this.x=t,this.y=e}var e=t.prototype;return e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.normalize=function(){return this.divideScalar(this.length()||1)},e.divideScalar=function(t){return this.multiplyScalar(1/t)},e.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},e.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},t}(),Q=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.isVector3=!0,this.x=t,this.y=e,this.z=n}var e=t.prototype;return e.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.normalize=function(){return this.divideScalar(this.length()||1)},e.divideScalar=function(t){return this.multiplyScalar(1/t)},e.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},e.crossVectors=function(t,e){var n=t.x,i=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},t}(),Z=Math.PI/180,$=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).position=new Q,r.value=new Float32Array([0,0,0]),r.mouse=null,r.dirty=!1,r.theta=(e||0)*Z,r.phi=(n||0)*Z,r.radius=i||6,r}n(e,t);var i=e.prototype;return i.down=function(t,e){this.mouse=new J(t,e)},i.move=function(t,e){var n=this.mouse;if(n&&(n.x!==t||n.y!==e)){var i=180*(t-n.x)*Z,r=180*(e-n.y)*Z;n.x=t,n.y=e,this.theta+=i,this.phi=Math.max(-60*Z,Math.min(60*Z,this.phi+r))}},i.up=function(){this.mouse=null},i.wheel=function(t){this.radius=Math.max(4,Math.min(10,this.radius+.02*t))},e.fromVector=function(t){var n=t.length();return new e(Math.acos(t.y/n),Math.atan(t.x/t.z),n)},e.toArray=function(t){var e=Math.sin(t.phi)*t.radius;return[e*Math.sin(t.theta),Math.cos(t.phi)*t.radius,e*Math.cos(t.theta)]},e}(Q),tt="undefined"!=typeof Float32Array?Float32Array:Array;function et(){var t=new tt(16);return tt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function nt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function it(t,e,n,i){var r,o,a,s,u,l,c,h,d,f,p,m,_,v,g,y,b,w,x,E,T,A,U,M,S=i[0],L=i[1],C=i[2],F=Math.hypot(S,L,C);return F<1e-6?null:(S*=F=1/F,L*=F,C*=F,r=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],p=e[7],m=e[8],_=e[9],v=e[10],g=e[11],y=S*S*a+o,b=L*S*a+C*r,w=C*S*a-L*r,x=S*L*a-C*r,E=L*L*a+o,T=C*L*a+S*r,A=S*C*a+L*r,U=L*C*a-S*r,M=C*C*a+o,t[0]=s*y+h*b+m*w,t[1]=u*y+d*b+_*w,t[2]=l*y+f*b+v*w,t[3]=c*y+p*b+g*w,t[4]=s*x+h*E+m*T,t[5]=u*x+d*E+_*T,t[6]=l*x+f*E+v*T,t[7]=c*x+p*E+g*T,t[8]=s*A+h*U+m*M,t[9]=u*A+d*U+_*M,t[10]=l*A+f*U+v*M,t[11]=c*A+p*U+g*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var rt,ot,at=function(){function t(){this.delay=0,this.current=0,this.delta=0,this.paused=!1,this.start=this.previous=this.now()}var e=t.prototype;return e.now=function(){return performance.now()},e.play=function(){if(this.previous){var t=this.now();this.delay+=t-this.previous,this.previous=t}this.paused=!1},e.pause=function(){this.paused=!0},e.next=function(){var t=this.now();return this.delta=t-this.previous,this.current=t-this.start-this.delay,this.previous=t,this},t}(),st=function(t,e){this.event=t,this.callback=e},ut=function(){function t(){this.listeners=new Set}var e=t.prototype;return e.logListeners=function(){this.listeners.forEach((function(t){return D.log(t)}))},e.subscribe=function(t){this.listeners.add(t)},e.unsubscribe=function(t){this.listeners.delete(t)},e.unsubscribeAll=function(){this.listeners.clear()},e.on=function(t,e){return this.listeners.add(new st(t,e)),this},e.off=function(t,e){var n=this;return e?this.listeners.delete(new st(t,e)):this.listeners.forEach((function(e){e.event===t&&n.listeners.delete(e)})),this},e.trigger=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.listeners.forEach((function(e){e.event===t&&"function"==typeof e.callback&&e.callback.apply(e,n)})),this},t}(),lt=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.createData_=function(){this.size=36,this.positions=[-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1],this.texcoords=[0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1],this.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];for(var t=[[1,1,1,1],[1,0,0,1],[0,1,0,1],[0,0,1,1],[1,1,0,1],[1,0,1,1]],e=[],n=0;n<t.length;++n){var i=t[n];e=e.concat(i,i,i,i,i,i)}this.colors=e},e}(W),ct=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e.prototype.createData_=function(){var t,e,n=2*Math.PI,i=Math.PI,r=new Q,o=new Q,a=[],s=[],u=[],l=[],c=[],h=Math.min(0+i,Math.PI),d=0,f=[];for(e=0;e<=60;e++){var p=[],m=e/60,_=0;for(0==e?_=.5/80:60==e&&h==Math.PI&&(_=-.5/80),t=0;t<=80;t++){var v=t/80;r.x=-1.4*Math.cos(0+v*n)*Math.sin(0+m*i),r.y=1.4*Math.cos(0+m*i),r.z=1.4*Math.sin(0+v*n)*Math.sin(0+m*i),s.push(r.x,r.y,r.z),o.copy(r).normalize(),u.push(o.x,o.y,o.z);var g=v+_,y=1-m;l.push(g,y),c.push(1,1,1,1),p.push(d++)}f.push(p)}for(e=0;e<60;e++)for(t=0;t<80;t++){var b=f[e][t+1],w=f[e][t],x=f[e+1][t],E=f[e+1][t+1];0!==e&&a.push(b,w,E),(59!==e||h<Math.PI)&&a.push(w,x,E)}this.size=a.length,this.positions=W.fromIndices(a,s,3),this.texcoords=W.fromIndices(a,l,2),this.normals=W.fromIndices(a,u,3),this.colors=W.fromIndices(a,c,4)},e}(W),ht=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var i=e.prototype;return i.createData_=function(){for(var t=200,e=[],n=[],i=[],r=[],o=[],a=new Q,s=new Q,u=new Q,l=new Q,c=new Q,h=new Q,d=new Q,f=0;f<=t;++f){var p=f/t*2*Math.PI*2;this.calculatePositionOnCurve(p,2,3,1,u),this.calculatePositionOnCurve(p+.01,2,3,1,l),h.subVectors(l,u),d.addVectors(l,u),c.crossVectors(h,d),d.crossVectors(c,h),c.normalize(),d.normalize();for(var m=0;m<=40;++m){var _=m/40*Math.PI*2,v=-.25*Math.cos(_),g=.25*Math.sin(_);a.x=u.x+(v*d.x+g*c.x),a.y=u.y+(v*d.y+g*c.y),a.z=u.z+(v*d.z+g*c.z),n.push(a.x,a.y,a.z),s.subVectors(a,u).normalize(),i.push(s.x,s.y,s.z),r.push(f/t*2*Math.round(3)),r.push(m/40),o.push(1,1,1,1)}}for(var y=1;y<=t;y++)for(var b=1;b<=40;b++){var w=41*(y-1)+(b-1),x=41*y+(b-1),E=41*y+b,T=41*(y-1)+b;e.push(w,x,T),e.push(x,E,T)}this.size=e.length,this.positions=W.fromIndices(e,n,3),this.texcoords=W.fromIndices(e,r,2),this.normals=W.fromIndices(e,i,3),this.colors=W.fromIndices(e,o,4)},i.calculatePositionOnCurve=function(t,e,n,i,r){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,u=Math.cos(s);r.x=i*(2+u)*.5*o,r.y=i*(2+u)*a*.5,r.z=i*Math.sin(s)*.5},e}(W),dt=[[1,1,1],[1,0,0],[0,1,0],[0,0,1],[1,1,0],[0,1,1]],ft=0,pt=function(){function t(){}var e=t.prototype;return e.load=function(t){var e=this;return new Promise((function(n,i){k.fetch(t).then((function(r){var o=e.parse(r);if(o.positions.length){var a=new W(o);n(a)}else i("ObjLoader error: empty positions "+t)}),(function(e){console.log("ObjLoader error:",e,t),i(e)}))}))},e.parseIndices=function(t,e,n,i,r,o){for(var a=0;a<=t.length-3;){var s=void 0,u=void 0,l=void 0;0===a?(s=a,u=a+1,l=a+2):(s=a-1,u=a+1,l=a+2),a++;for(var c=[s,u,l],h=0;h<c.length;h++){var d=t[c[h]][e],f=void 0;d&&NaN!==d&&(f=i[d-1])&&(f=f.slice(0,n),r.push.apply(r,f))}}},e.parseFaces=function(t,e,n,i,r,o,a,s){var u=this,l=r.length;t.forEach((function(t){u.parseIndices(t,0,3,e,r,"positions"),u.parseIndices(t,2,3,n,o,"normals"),u.parseIndices(t,1,2,i,a,"texcoords")}));var c=r.length-l;c>0&&(new Array(c/3).fill(0).forEach((function(){var t=dt[ft%dt.length];s.push(t[0],t[1],t[2],1)})),ft++)},e.parse=function(t){var e=this,n=[],i=[],r=[],o=[];ft=0;var a=[],s=[],u=[],l=[];-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),(t=t.replace(/  /g," ")).split("\n").forEach((function(t,c){if(0===t.indexOf("v ")){l.length&&(e.parseFaces(l,a,s,u,n,i,r,o),l=[]);var h=t.replace("v","").trim().split(" ").map((function(t){return parseFloat(t)}));a.push(h)}else if(0===t.indexOf("vn ")){var d=t.replace("vn","").trim().split(" ").map((function(t){return parseFloat(t)})),f=new Q(d[0],d[1],d[2]).normalize();s.push([f.x,f.y,f.z])}else if(0===t.indexOf("vt ")){var p=t.replace("vt","").trim().split(" ").map((function(t){return parseFloat(t)}));u.push(p)}else if(0===t.indexOf("f ")){var m=t.replace("f","").trim().split(" ").map((function(t){var e=t.split("/").map((function(t){return parseInt(t)}));return 2===e.length&&e.push(null),e}));l[l.length]=m}})),l.length&&this.parseFaces(l,a,s,u,n,i,r,o);for(var c={min:new Q(Number.POSITIVE_INFINITY),max:new Q(Number.NEGATIVE_INFINITY)},h=0;h<n.length;h+=3)c.min.x=Math.min(c.min.x,n[h]),c.min.y=Math.min(c.min.y,n[h+1]),c.min.z=Math.min(c.min.z,n[h+2]),c.max.x=Math.max(c.max.x,n[h]),c.max.y=Math.max(c.max.y,n[h+1]),c.max.z=Math.max(c.max.z,n[h+2]);for(var d=-(c.min.x+c.max.x)/2,f=-(c.min.y+c.max.y)/2,p=-(c.min.z+c.max.z)/2,m=0;m<n.length;m+=3)n[m]+=d,n[m+1]+=f,n[m+2]+=p;var _=n.reduce((function(t,e){return Math.max(t,e)}),0);return n.forEach((function(t,e){return n[e]=t/_*2})),i.length||(i=n.slice()),r.length||(r=this.unrapUvw(n)),{positions:n,normals:i,texcoords:r,colors:o}},e.unrapUvw=function(t){for(var e=[],n=0;n<t.length;n+=3){var i=new Q(t[n],t[n+1],t[n+2]);i.normalize();var r=Math.asin(-i.y),o=Math.atan2(i.x,i.z),a=.5+r/Math.PI,s=.5+o/(2*Math.PI);e.push(a,s)}return e},t}(),mt=["jpg","jpeg","png"],_t=["ogv","webm","mp4"],vt=mt.concat(_t);function gt(t){return"data"in t&&"width"in t&&"height"in t}(rt=t.TextureSourceType||(t.TextureSourceType={}))[rt.Data=0]="Data",rt[rt.Element=1]="Element",rt[rt.Url=2]="Url",(ot=t.TextureFilteringType||(t.TextureFilteringType={})).MipMap="mipmap",ot.Linear="linear",ot.Nearest="nearest";var yt,bt,wt=function(e){function i(n,i,r,o,a){var s;return void 0===o&&(o={filtering:t.TextureFilteringType.Linear}),(s=e.call(this)||this).valid=!1,s.dirty=!1,s.animated=!1,s.powerOf2=!1,s.key=i,s.index=r,s.options=o,s.workpath=a,s.create(n),s}n(i,e),i.isPowerOf2=function(t){return 0==(t&t-1)},i.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},i.isTextureUrl=function(t){return t&&/\.(jpg|jpeg|png|ogv|webm|mp4)$/i.test(t.split("?")[0])},i.isTexture=function(t){return void 0!==i.getTextureOptions(t)},i.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},i.getTextureOptions=function(t,e){if(void 0===e&&(e={}),"string"==typeof t&&""!==t){if(i.isTextureUrl(t))return e.url=t,-1!==t.indexOf("?")&&(e=t.split("?")[1].split("&").reduce((function(t,e){var n=e.split("="),i=decodeURIComponent(n[0]),r=decodeURIComponent(n[1]);switch(i){case"filtering":t[i]=r;break;case"repeat":case"UNPACK_FLIP_Y_WEBGL":t[i]=Boolean(r);break;case"UNPACK_PREMULTIPLY_ALPHA_WEBGL":case"TEXTURE_WRAP_S":case"TEXTURE_WRAP_T":t[i]=Number(r)}return t}),e)),e;document&&(t=document.querySelector(t))}return t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement?(e.element=t,e):gt(t)?(e.data=t.data,e.width=t.width,e.height=t.height,e):null};var r=i.prototype;return r.create=function(t){this.texture=t.createTexture(),this.texture&&(this.valid=!0),this.setData(t,1,1,new Uint8Array([0,0,0,0]),this.options)},r.load=function(t,e){return void 0===e&&(e={}),this.options=e,"string"==typeof e.url?void 0===this.url||e.url!==this.url?this.setUrl(t,e.url,e):Promise.resolve(this):e.element?this.setElement(t,e.element,e):e.data&&e.width&&e.height?this.setData(t,e.width,e.height,e.data,e):Promise.reject(this)},r.setUrl=function(e,n,r){if(void 0===r&&(r={}),!this.valid)return Promise.reject(this);this.url=n,this.source=n,this.sourceType=t.TextureSourceType.Url,this.options=Object.assign(this.options,r);var o,a,s=n.split("?")[0].split(".").pop().toLowerCase(),u=-1!==_t.indexOf(s),l=k.getResource(n,this.workpath);return u?(D.log("GlslCanvas.setUrl video",l),(o=document.createElement("video")).setAttribute("preload","auto"),o.setAttribute("loop","true"),o.setAttribute("muted","true"),o.setAttribute("playsinline","true"),o.loop=!0,o.muted=!0,a=this.setElement(e,o,r),o.src=l,o.addEventListener("canplay",(function(){o.play()}))):(D.log("GlslCanvas.setUrl image",l),o=document.createElement("img"),a=this.setElement(e,o,r),i.isSafari()&&"data:"===n.slice(0,5)||(o.crossOrigin="anonymous"),o.src=l),a},r.setElement=function(e,n,i){var r=this;return void 0===i&&(i={}),i=this.options=Object.assign(this.options,i),new Promise((function(o,a){var s=n;if("string"==typeof n&&(n=document.querySelector(n)),n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof HTMLVideoElement)if(r.source=n,r.sourceType=t.TextureSourceType.Element,n instanceof HTMLVideoElement){var u=n;u.addEventListener("loadeddata",(function(t){r.update(e,i),r.setFiltering(e,i),o(r)})),u.addEventListener("error",(function(t){a(t)})),u.load()}else n instanceof HTMLImageElement?(n.addEventListener("load",(function(){r.update(e,i),r.setFiltering(e,i),o(r)})),n.addEventListener("error",(function(t){a(t)}))):(r.update(e,i),r.setFiltering(e,i),o(r));else{var l="the 'element' parameter (`element: "+JSON.stringify(s)+"`) must be a CSS selector string, or a <canvas>, <image> or <video> object";D.log("Texture '"+r.key+"': "+l,i),a(l)}}))},r.setData=function(e,n,i,r,o){return void 0===o&&(o={}),this.width=n,this.height=i,this.options=Object.assign(this.options,o),this.source=r,this.sourceType=t.TextureSourceType.Data,this.update(e,o),this.setFiltering(e,o),Promise.resolve(this)},r.update=function(e,n){if(this.valid){if(e.activeTexture(e.TEXTURE0+this.index),e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1===n.UNPACK_FLIP_Y_WEBGL?0:1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.UNPACK_PREMULTIPLY_ALPHA_WEBGL||0),this.sourceType===t.TextureSourceType.Element)this.source instanceof HTMLImageElement&&this.source.naturalWidth&&this.source.naturalHeight?(this.width=this.source.naturalWidth,this.height=this.source.naturalHeight,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLVideoElement&&this.source.videoWidth&&this.source.videoHeight?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLCanvasElement&&(this.width=this.source.width,this.height=this.source.height,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source));else if(this.sourceType===t.TextureSourceType.Data){var i=this.source;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,i)}this.trigger("loaded",this)}},r.tryUpdate=function(t){var e=!1;return this.animated&&(e=!0,this.update(t,this.options)),e},r.destroy=function(t){this.valid&&(t.deleteTexture(this.texture),this.texture=null,delete this.source,this.source=null,this.valid=!1)},r.setFiltering=function(e,n){if(this.valid){var r=i.isPowerOf2(this.width)&&i.isPowerOf2(this.height),o=n.filtering||t.TextureFilteringType.MipMap,a=n.TEXTURE_WRAP_S||(n.repeat?e.REPEAT:e.CLAMP_TO_EDGE),s=n.TEXTURE_WRAP_T||(n.repeat?e.REPEAT:e.CLAMP_TO_EDGE);r||(o=o===t.TextureFilteringType.MipMap?t.TextureFilteringType.Linear:o,a=s=e.CLAMP_TO_EDGE,(n.repeat||n.TEXTURE_WRAP_S||n.TEXTURE_WRAP_T)&&D.warn("GlslCanvas: cannot repeat texture "+n.url+" cause is not power of 2.")),this.powerOf2=r,this.filtering=o,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),this.filtering===t.TextureFilteringType.MipMap?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):this.filtering===t.TextureFilteringType.Nearest?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):this.filtering===t.TextureFilteringType.Linear&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR))}},i}(ut),xt=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).count=0,e.dirty=!1,e.animated=!1,e}n(e,t);var i=e.prototype;return i.clean=function(){var t=this;Object.keys(this.values).forEach((function(e){t.values[e].dirty=!1})),this.dirty=!1},i.createOrUpdate=function(t,e,n,i,r,o){var a,s=this;void 0===i&&(i=0),void 0===r&&(r={});var u=wt.getTextureOptions(n,r);return(a=this.get(e))||(a=new wt(t,e,i+this.count,u,o),this.count++,this.set(e,a)),void 0!==u?a.load(t,u).then((function(e){if(e.source instanceof HTMLVideoElement){var n=e.source;n.addEventListener("play",(function(){e.animated=!0,s.animated=!0})),n.addEventListener("pause",(function(){e.animated=!1,s.animated=s.reduce((function(t,e){return t||e.animated}),!1)})),n.addEventListener("seeked",(function(){e.update(t,e.options),s.dirty=!0}))}return e})):Promise.resolve(a)},e}(G);(yt=t.UniformMethod||(t.UniformMethod={}))[yt.Unknown=0]="Unknown",yt.Uniform1i="uniform1i",yt.Uniform2i="uniform2i",yt.Uniform3i="uniform3i",yt.Uniform4i="uniform4i",yt.Uniform1f="uniform1f",yt.Uniform2f="uniform2f",yt.Uniform3f="uniform3f",yt.Uniform4f="uniform4f",yt.Uniform1iv="uniform1iv",yt.Uniform2iv="uniform2iv",yt.Uniform3iv="uniform3iv",yt.Uniform4iv="uniform4iv",yt.Uniform1fv="uniform1fv",yt.Uniform2fv="uniform2fv",yt.Uniform3fv="uniform3fv",yt.Uniform4fv="uniform4fv",yt.UniformMatrix2fv="uniformMatrix2fv",yt.UniformMatrix3fv="uniformMatrix3fv",yt.UniformMatrix4fv="uniformMatrix4fv",(bt=t.UniformType||(t.UniformType={}))[bt.Unknown=0]="Unknown",bt[bt.Float=1]="Float",bt[bt.Int=2]="Int",bt[bt.Bool=3]="Bool",bt[bt.Sampler2D=4]="Sampler2D",bt[bt.SamplerCube=5]="SamplerCube",bt[bt.Matrix2fv=6]="Matrix2fv",bt[bt.Matrix3fv=7]="Matrix3fv",bt[bt.Matrix4fv=8]="Matrix4fv";var Et=[t.UniformMethod.Uniform1i,t.UniformMethod.Uniform2i,t.UniformMethod.Uniform3i,t.UniformMethod.Uniform4i],Tt=[t.UniformMethod.Uniform1f,t.UniformMethod.Uniform2f,t.UniformMethod.Uniform3f,t.UniformMethod.Uniform4f],At=[t.UniformMethod.Uniform1iv,t.UniformMethod.Uniform2iv,t.UniformMethod.Uniform3iv,t.UniformMethod.Uniform4iv],Ut=[t.UniformMethod.Uniform1fv,t.UniformMethod.Uniform2fv,t.UniformMethod.Uniform3fv,t.UniformMethod.Uniform4fv],Mt=function(e){var n=this;switch(this.dirty=!0,e&&Object.assign(this,e),this.method){case t.UniformMethod.UniformMatrix2fv:case t.UniformMethod.UniformMatrix3fv:case t.UniformMethod.UniformMatrix4fv:this.apply=function(t,e){if(n.dirty){t.useProgram(e);var i=t.getUniformLocation(e,n.key);t[n.method].apply(t,[i,!1].concat(n.values))}};break;default:this.apply=function(t,e){if(n.dirty){t.useProgram(e);var i=t.getUniformLocation(e,n.key);t[n.method].apply(t,[i].concat(n.values))}}}},St=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e}(Mt),Lt=function(e){function i(){var t;return(t=e.apply(this,arguments)||this).dirty=!1,t}n(i,e),i.isArrayOfInteger=function(t){return t.reduce((function(t,e){return t&&Number.isInteger(e)}),!0)},i.isArrayOfNumber=function(t){return t.reduce((function(t,e){return t&&"number"==typeof e}),!0)},i.isArrayOfBoolean=function(t){return t.reduce((function(t,e){return t&&"boolean"==typeof e}),!0)},i.isArrayOfTexture=function(t){return t.reduce((function(t,e){return t&&wt.isTexture(e)}),!0)},i.isArrayOfSampler2D=function(e){return e.reduce((function(e,n){return e&&n.type===t.UniformType.Sampler2D}),!0)},i.getType_=function(e){var n=t.UniformType.Unknown,r=1===e.length&&Array.isArray(e[0])?e[0]:e;return i.isArrayOfNumber(r)?n=t.UniformType.Float:i.isArrayOfBoolean(r)?n=t.UniformType.Bool:i.isArrayOfTexture(r)&&(n=t.UniformType.Sampler2D),n},i.getMethod_=function(e,n){var i=t.UniformMethod.Unknown,r=1===n.length&&Array.isArray(n[0]),o=(r?n[0]:n).length,a=o-1;switch(e){case t.UniformType.Float:i=r?a<Ut.length?Ut[a]:t.UniformMethod.Unknown:a<Tt.length?Tt[a]:t.UniformMethod.Uniform1fv;break;case t.UniformType.Int:case t.UniformType.Bool:i=r?a<At.length?At[a]:t.UniformMethod.Unknown:a<Et.length?Et[a]:t.UniformMethod.Uniform1iv;break;case t.UniformType.Sampler2D:i=r?t.UniformMethod.Uniform1iv:1===o?t.UniformMethod.Uniform1i:t.UniformMethod.Uniform1iv}return i},i.parseUniform=function(e,n,r){var o;void 0===r&&(r=null),r=r||i.getType_(n);var a=i.getMethod_(r,n);if(r!==t.UniformType.Unknown&&a!==t.UniformMethod.Unknown){if(r===t.UniformType.Sampler2D&&a===t.UniformMethod.Uniform1iv)return n[0].map((function(t,n){return new Mt({method:a,type:r,key:e+"["+n+"]",values:[t]})}));o=new Mt({method:a,type:r,key:e,values:n})}else D.error("Uniforms.parseUniform.Unknown",e,n);return o};var r=i.prototype;return r.create=function(t,e,n,i){var r=new Mt({method:t,type:e,key:n,values:i});return this.set(n,r),this.dirty=!0,r},r.createTexture=function(e,n){var i;return i=-1!==e.indexOf("]")?new St({method:t.UniformMethod.Uniform1iv,type:t.UniformType.Sampler2D,key:e,values:[[n]]}):new St({method:t.UniformMethod.Uniform1i,type:t.UniformType.Sampler2D,key:e,values:[n]}),this.set(e,i),this.dirty=!0,i},r.update=function(t,e,n,i){var r=this.get(n);r&&(r.method=t,r.type=e,r.values=i,r.dirty=!0,this.dirty=!0)},r.createOrUpdate=function(t,e,n,i){this.has(n)?this.update(t,e,n,i):this.create(t,e,n,i)},r.apply=function(t,e){var n=this;t.useProgram(e),Object.keys(this.values).forEach((function(i){n.values[i].apply(t,e)}))},r.clean=function(){var t=this;Object.keys(this.values).forEach((function(e){t.values[e].dirty=!1})),this.dirty=!1},i.isDifferent=function(t,e){return t.length!==e.length||t.reduce((function(t,n,i){return t||n!==e[i]}),!1)},i}(G),Ct=function(e){function i(){var t;return(t=e.call(this)||this).uniforms=new Lt,t.buffers=new K,t.textures=new xt,t.textureList=[],t.W=0,t.H=0,t.mouse=new J,t.radians=0,t.dirty=!0,t.animated=!1,t.camera=new $,t.cache={},t.drawFunc_=t.drawArrays_,t}n(i,e);var r=i.prototype;return r.render=function(){var t=this,e=this.gl;if(e){var n=e.drawingBufferWidth,i=e.drawingBufferHeight;this.update_(),e.viewport(0,0,n,i);var r=this.uniforms;Object.keys(this.buffers.values).forEach((function(o){var a=t.buffers.values[o];a.geometry.attachAttributes_(e,a.program),r.apply(e,a.program),a.render(e,n,i)})),this.geometry.attachAttributes_(e,this.program),r.apply(e,this.program),this.drawFunc_(this.timer.delta),r.clean(),this.textures.clean(),this.dirty=!1,this.trigger("render",this)}},r.drawArrays_=function(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.W,this.H),e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),this.doubleSided&&this.mode!==P.Flat&&(e.cullFace(e.FRONT),e.drawArrays(e.TRIANGLES,0,this.geometry.size),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),e.cullFace(e.BACK),e.drawArrays(e.TRIANGLES,0,this.geometry.size)},r.create_=function(){this.createGeometry_(),this.createUniforms_()},r.createGeometry_=function(){this.parseGeometry_(),this.setMode(this.mode)},r.parseGeometry_=function(){var t=/^attribute\s+vec4\s+a_position\s*;\s*\/\/\s*([\w|\:\/\/|\.|\-|\_|\?|\&|\=]+)/gm.exec(this.vertexString);t&&t.length>1?this.mesh=t[1]:this.mesh=this.defaultMesh},r.createUniforms_=function(){var e=this.gl,n=this.fragmentString,i=e.drawingBufferWidth,r=e.drawingBufferHeight,o=this.timer=new at,a=(n.match(/u_delta/g)||[]).length>1,s=(n.match(/u_time/g)||[]).length>1,u=(n.match(/u_date/g)||[]).length>1,l=(n.match(/u_mouse/g)||[]).length>1,c=(n.match(/u_camera/g)||[]).length>1;this.animated=!0;var h=this.uniforms;if(h.create(t.UniformMethod.Uniform2f,t.UniformType.Float,"u_resolution",[i,r]),a?(h.create(t.UniformMethod.Uniform1f,t.UniformType.Float,"u_delta",[o.delta/1e3]),this.updateUniformDelta_=this.updateUniformDelta__):this.updateUniformDelta_=this.updateUniformNoop_,s?(h.create(t.UniformMethod.Uniform1f,t.UniformType.Float,"u_time",[o.current/1e3]),this.updateUniformTime_=this.updateUniformTime__):this.updateUniformTime_=this.updateUniformNoop_,u){var d=new Date;h.create(t.UniformMethod.Uniform4f,t.UniformType.Float,"u_date",[d.getFullYear(),d.getMonth(),d.getDate(),3600*d.getHours()+60*d.getMinutes()+d.getSeconds()+.001*d.getMilliseconds()]),this.updateUniformDate_=this.updateUniformDate__}else this.updateUniformDate_=this.updateUniformNoop_;l?(h.create(t.UniformMethod.Uniform2f,t.UniformType.Float,"u_mouse",[0,0]),this.updateUniformMouse_=this.updateUniformMouse__):this.updateUniformMouse_=this.updateUniformNoop_,c?(h.create(t.UniformMethod.Uniform3f,t.UniformType.Float,"u_camera",[0,0,0]),this.updateUniformCamera_=this.updateUniformCamera__):this.updateUniformCamera_=this.updateUniformNoop_,this.projectionMatrix=et(),h.create(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_projectionMatrix",this.projectionMatrix),this.modelViewMatrix=et(),h.create(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_modelViewMatrix",this.modelViewMatrix),this.normalMatrix=et(),h.create(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_normalMatrix",this.normalMatrix)},r.update_=function(){var e=this.gl,n=e.drawingBufferWidth,i=e.drawingBufferHeight;if(this.timer){var r=this.timer.next();this.uniforms.update(t.UniformMethod.Uniform2f,t.UniformType.Float,"u_resolution",[n,i]),this.updateUniformDelta_(r),this.updateUniformTime_(r),this.updateUniformDate_(),this.updateUniformMouse_(),this.updateUniformCamera_(),this.updateUniformMesh_()}},r.updateUniformNoop_=function(){},r.updateUniformDelta__=function(e){this.uniforms.update(t.UniformMethod.Uniform1f,t.UniformType.Float,"u_delta",[e.delta/1e3])},r.updateUniformTime__=function(e){this.uniforms.update(t.UniformMethod.Uniform1f,t.UniformType.Float,"u_time",[e.current/1e3])},r.updateUniformDate__=function(){var e=this.uniforms,n=new Date;e.update(t.UniformMethod.Uniform4f,t.UniformType.Float,"u_date",[n.getFullYear(),n.getMonth(),n.getDate(),3600*n.getHours()+60*n.getMinutes()+n.getSeconds()+.001*n.getMilliseconds()])},r.updateUniformMouse__=function(){var e=this.uniforms,n=this.mouse;e.update(t.UniformMethod.Uniform2f,t.UniformType.Float,"u_mouse",[n.x,n.y])},r.updateUniformCamera__=function(){var e=this.uniforms,n=$.toArray(this.camera);e.update(t.UniformMethod.Uniform3f,t.UniformType.Float,"u_camera",n)},r.updateUniformMesh__=function(){var e=this.uniforms;e.update(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_projectionMatrix",this.updateProjectionMatrix_()),e.update(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_modelViewMatrix",this.updateModelViewMatrix_(this.timer.delta)),e.update(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_normalMatrix",this.updateNormalMatrix_(this.modelViewMatrix))},r.updateUniformFlat__=function(){var e=this.uniforms;e.update(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_projectionMatrix",et()),e.update(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_modelViewMatrix",et()),e.update(t.UniformMethod.UniformMatrix4fv,t.UniformType.Float,"u_normalMatrix",et())},r.updateProjectionMatrix_=function(){var t=this.gl,e=45*Math.PI/180,n=t.drawingBufferWidth/t.drawingBufferHeight;return function(t,e,n,i,r){var o,a=1/Math.tan(e/2);t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o=1/(i-r),t[10]=(r+i)*o,t[14]=20*o}(this.projectionMatrix,e,n,.1,100),this.projectionMatrix},r.updateModelViewMatrix_=function(t){var e,n,i,r,o,a,s,u,l,c,h,d,f,p,m,_,v,g,y=this.camera,b=this.modelViewMatrix;return e=b=nt(b),n=b,_=(i=[0,0,-y.radius])[0],v=i[1],g=i[2],n===e?(e[12]=n[0]*_+n[4]*v+n[8]*g+n[12],e[13]=n[1]*_+n[5]*v+n[9]*g+n[13],e[14]=n[2]*_+n[6]*v+n[10]*g+n[14],e[15]=n[3]*_+n[7]*v+n[11]*g+n[15]):(r=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],d=n[8],f=n[9],p=n[10],m=n[11],e[0]=r,e[1]=o,e[2]=a,e[3]=s,e[4]=u,e[5]=l,e[6]=c,e[7]=h,e[8]=d,e[9]=f,e[10]=p,e[11]=m,e[12]=r*_+u*v+d*g+n[12],e[13]=o*_+l*v+f*g+n[13],e[14]=a*_+c*v+p*g+n[14],e[15]=s*_+h*v+m*g+n[15]),it(b,b,y.theta+this.radians,[0,1,0]),it(b,b,y.phi,[1,0,0]),y.mouse||(y.theta+=(0-y.theta)/20,y.phi+=(0-y.phi)/20,this.radians+=5e-4*t),b},r.updateNormalMatrix_=function(t){var e,n,i,r,o,a,s,u,l,c,h,d,f,p,m,_,v,g,y,b,w,x,E,T,A,U,M,S,L,C,F,R=this.normalMatrix;return e=R=nt(R),i=(n=t)[0],r=n[1],o=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],_=n[13],v=n[14],(F=(y=i*u-r*s)*(C=f*(g=n[15])-p*v)-(b=i*l-o*s)*(L=d*g-p*_)+(w=i*c-a*s)*(S=d*v-f*_)+(x=r*l-o*u)*(M=h*g-p*m)-(E=r*c-a*u)*(U=h*v-f*m)+(T=o*c-a*l)*(A=h*_-d*m))&&(F=1/F,e[0]=(u*C-l*L+c*S)*F,e[1]=(o*L-r*C-a*S)*F,e[2]=(_*T-v*E+g*x)*F,e[3]=(f*E-d*T-p*x)*F,e[4]=(l*M-s*C-c*U)*F,e[5]=(i*C-o*M+a*U)*F,e[6]=(v*w-m*T-g*b)*F,e[7]=(h*T-f*w+p*b)*F,e[8]=(s*L-u*M+c*A)*F,e[9]=(r*M-i*L-a*A)*F,e[10]=(m*E-_*w+g*y)*F,e[11]=(d*w-h*E-p*y)*F,e[12]=(u*U-s*S-l*A)*F,e[13]=(i*S-r*U+o*A)*F,e[14]=(_*b-m*x-v*y)*F,e[15]=(h*x-d*b+f*y)*F),function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(R,R),R},r.setMode=function(t){var e,n=this;if(t===P.Mesh&&(e=this.cache[this.mesh]))return this.geometry=e,this.mode=P.Mesh,this.updateUniformMesh_=this.updateUniformMesh__,void(this.dirty=!0);switch(t){case P.Flat:e=new X,this.updateUniformMesh_=this.updateUniformNoop_,this.updateUniformFlat__();break;case P.Box:e=new lt,this.updateUniformMesh_=this.updateUniformMesh__;break;case P.Sphere:e=new ct,this.updateUniformMesh_=this.updateUniformMesh__;break;case P.Torus:e=new ht,this.updateUniformMesh_=this.updateUniformMesh__;break;case P.Mesh:e=new X,this.mesh?(new pt).load(k.getResource(this.mesh,this.workpath)).then((function(t){t.createAttributes_(n.gl,n.program);var e={};e[n.mesh]=t,n.cache=e,n.geometry=t,n.dirty=!0}),(function(t){D.warn("GlslCanvas",t),n.mode=P.Flat})):t=P.Flat,this.updateUniformMesh_=this.updateUniformMesh__}e.create(this.gl,this.program),this.geometry=e,this.mode=t,this.dirty=!0},r.setMesh=function(t){this.mesh=t},i}(ut),Ft=function(e){function i(t,n){var o;return void 0===n&&(n={}),(o=e.call(this)||this).valid=!1,o.visible=!1,o.controls=!1,o.vertexPath="",o.fragmentPath="",t?(o.options=n,o.canvas=t,o.width=0,o.height=0,o.rect=t.getBoundingClientRect(),o.devicePixelRatio=window.devicePixelRatio||1,o.mode=n.mode||P.Flat,o.mesh=n.mesh||void 0,o.doubleSided=n.doubleSided||!1,o.defaultMesh=o.mesh,o.workpath=n.workpath,t.style.backgroundColor=n.backgroundColor||"rgba(0,0,0,0)",o.getShaders_().then((function(t){o.load().then((function(t){o.program&&(o.addListeners_(),o.onLoop())}))}),(function(t){D.error("GlslCanvas.getShaders_.error",t)})),i.items.push(r(o)),o):r(o)}n(i,e);var o=i.prototype;return o.getShaders_=function(){var t=this;return new Promise((function(e){t.vertexString=t.options.vertexString||t.vertexString,t.fragmentString=t.options.fragmentString||t.fragmentString;var n=t.canvas,i={};n.hasAttribute("data-vertex-url")&&(i.vertex=n.getAttribute("data-vertex-url")),n.hasAttribute("data-fragment-url")&&(i.fragment=n.getAttribute("data-fragment-url")),n.hasAttribute("data-vertex")&&(t.vertexString=n.getAttribute("data-vertex")),n.hasAttribute("data-fragment")&&(t.fragmentString=n.getAttribute("data-fragment")),Object.keys(i).length?Promise.all(Object.keys(i).map((function(e){var n=k.getResource(i[e],t.workpath);return k.fetch(n).then((function(n){var r=k.dirname(i[e]);return"vertex"===e?(t.vertexPath=r,t.vertexString=n):(t.fragmentPath=r,t.fragmentString=n)}))}))).then((function(n){e([t.vertexString,t.fragmentString])})):e([t.vertexString,t.fragmentString])}))},o.addListeners_=function(){this.onScroll=this.onScroll.bind(this),this.onWheel=this.onWheel.bind(this),this.onClick=this.onClick.bind(this),this.onMove=this.onMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onLoop=this.onLoop.bind(this),window.addEventListener("scroll",this.onScroll),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("touchmove",this.onTouchMove),this.addCanvasListeners_()},o.addCanvasListeners_=function(){this.controls=this.canvas.hasAttribute("controls"),this.canvas.addEventListener("wheel",this.onWheel),this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("touchstart",this.onTouchStart),this.controls&&(this.canvas.addEventListener("mouseover",this.onMouseOver),this.canvas.addEventListener("mouseout",this.onMouseOut),this.canvas.hasAttribute("data-autoplay")||this.pause())},o.removeCanvasListeners_=function(){this.canvas.removeEventListener("wheel",this.onWheel),this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("touchstart",this.onTouchStart),this.canvas.removeEventListener("touchend",this.onTouchEnd),this.controls&&(this.canvas.removeEventListener("mouseover",this.onMouseOver),this.canvas.removeEventListener("mouseout",this.onMouseOut))},o.removeListeners_=function(){window.cancelAnimationFrame(this.rafId),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove),this.removeCanvasListeners_()},o.onScroll=function(t){this.rect=this.canvas.getBoundingClientRect()},o.onWheel=function(t){this.camera.wheel(t.deltaY),this.dirty=this.mode!==P.Flat,this.trigger("wheel",t)},o.onClick=function(t){this.controls&&this.toggle(),this.trigger("click",t)},o.onDown=function(t,e){var n=this.rect;t-=n.left,e=n.height-(e-n.top);var i=t*this.devicePixelRatio,r=e*this.devicePixelRatio;this.mouse.x=i,this.mouse.y=r;var o=Math.min(n.width,n.height);this.camera.down(t/o,e/o),this.trigger("down",this.mouse)},o.onMove=function(t,e){var n=this.rect;t-=n.left,e=n.height-(e-n.top);var i=t*this.devicePixelRatio,r=e*this.devicePixelRatio;if(i!==this.mouse.x||r!==this.mouse.y){this.mouse.x=i,this.mouse.y=r;var o=Math.min(n.width,n.height);this.camera.move(t/o,e/o),this.dirty=this.mode!==P.Flat&&null!==this.camera.mouse,this.trigger("move",this.mouse)}},o.onUp=function(t){this.camera.up(),this.controls&&this.pause(),this.trigger("out",t)},o.onMouseDown=function(t){this.onDown(t.clientX,t.clientY),document.addEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove)},o.onMouseMove=function(t){this.onMove(t.clientX,t.clientY)},o.onMouseUp=function(t){this.onUp(t)},o.onMouseOver=function(t){this.play(),this.trigger("over",t)},o.onMouseOut=function(t){this.pause(),this.trigger("out",t)},o.onTouchStart=function(t){var e=[].slice.call(t.touches).reduce((function(t,e){return(t=t||new J).x+=e.clientX,t.y+=e.clientY,t}),null);e&&this.onDown(e.x/t.touches.length,e.y/t.touches.length),this.controls&&this.play(),this.trigger("over",t),document.addEventListener("touchend",this.onTouchEnd),document.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),this.controls&&(this.canvas.removeEventListener("mouseover",this.onMouseOver),this.canvas.removeEventListener("mouseout",this.onMouseOut))},o.onTouchMove=function(t){var e=[].slice.call(t.touches).reduce((function(t,e){return(t=t||new J).x+=e.clientX,t.y+=e.clientY,t}),null);e&&this.onMove(e.x/t.touches.length,e.y/t.touches.length)},o.onTouchEnd=function(t){this.onUp(t),document.removeEventListener("touchend",this.onTouchEnd)},o.onLoop=function(t){this.checkRender(),this.rafId=window.requestAnimationFrame(this.onLoop)},o.setUniform_=function(e,n,i,r){var o=this;void 0===i&&(i={}),void 0===r&&(r=null);var a=Lt.parseUniform(e,n,r);if(Array.isArray(a))Lt.isArrayOfSampler2D(a)?a.forEach((function(t){return o.loadTexture(t.key,t.values[0],i)})):a.forEach((function(t){return o.uniforms.set(t.key,t.values[0])}));else if(a)switch(a.type){case t.UniformType.Sampler2D:this.loadTexture(e,n[0],i);break;default:this.uniforms.set(e,a)}},o.isVisible_=function(){var t=this.rect;return t.top+t.height>0&&t.top<(window.innerHeight||document.documentElement.clientHeight)},o.isAnimated_=function(){return(this.animated||this.textures.animated||this.mode!==P.Flat)&&!this.timer.paused},o.isDirty_=function(){return this.dirty||this.uniforms.dirty||this.textures.dirty},o.sizeDidChanged_=function(){var t=this,e=this.gl,n=Math.ceil(this.canvas.clientWidth),i=Math.ceil(this.canvas.clientHeight);if(this.width!==n||this.height!==i){this.width=n,this.height=i;var r=Math.ceil(n*this.devicePixelRatio),o=Math.ceil(i*this.devicePixelRatio);return this.W=r,this.H=o,this.canvas.width=r,this.canvas.height=o,Object.keys(this.buffers.values).forEach((function(n){t.buffers.values[n].resize(e,r,o)})),this.rect=this.canvas.getBoundingClientRect(),this.trigger("resize"),!0}return!1},o.parseTextures_=function(t){for(var e,n=this,i=/uniform\s*sampler2D\s*([\w]*);(\s*\/\/\s*([\w|\:\/\/|\.|\-|\_|\?|\&|\=]*)|\s*)/gm;null!==(e=i.exec(t));){var r=e[1],o=e[3];wt.isTextureUrl(o)?this.textureList.push({key:r,url:o}):this.buffers.has(r)||this.textureList.push({key:r,url:null})}return this.canvas.hasAttribute("data-textures")&&this.canvas.getAttribute("data-textures").split(",").forEach((function(t,e){var i="u_texture"+e;n.textureList.push({key:i,url:t})})),this.textureList.length>0},o.load=function(t,e){var n=this,i=j.getFragmentVertex(this.gl,t||this.fragmentString);return Promise.all([j.getIncludes(t||this.fragmentString,""===this.fragmentPath?this.workpath:this.fragmentPath),j.getIncludes(i||e||this.vertexString,""===this.vertexPath?this.workpath:this.vertexPath)]).then((function(t){return n.fragmentString=t[0],n.vertexString=t[1],n.createContext_()}))},o.getContext_=function(){var t=this.vertexString,e=this.fragmentString;if(this.vertexString=j.getVertex(t,e,this.mode),this.fragmentString=j.getFragment(t,e,this.mode),j.versionDiffers(this.gl,t,e)&&(this.destroyContext_(),this.swapCanvas_(),this.uniforms=new Lt,this.buffers=new K,this.textures=new xt,this.textureList=[]),!this.gl){var n=j.tryInferContext(t,e,this.canvas,this.options,this.options.extensions,this.options.onError);if(!n)return null;this.gl=n}return this.gl},o.createContext_=function(){var t,e,n=this.getContext_();if(!n)return!1;try{if(j.inferPrecision(this.fragmentString),t=j.createShader(n,this.vertexString,n.VERTEX_SHADER),e=j.createShader(n,this.fragmentString,n.FRAGMENT_SHADER))this.valid=!0;else{var i=j.getFragment(null,null,this.mode);e=j.createShader(n,i,n.FRAGMENT_SHADER),this.valid=!1}}catch(t){return this.trigger("error",t),!1}var r=j.createProgram(n,[t,e]);if(!r)return this.trigger("error",j.lastError),!1;if(n.deleteShader(t),n.deleteShader(e),this.program=r,this.valid){try{this.buffers=K.getBuffers(n,this.fragmentString,j.getBufferVertex(n))}catch(t){return this.valid=!1,this.trigger("error",t),!1}this.create_(),this.animated?this.canvas.classList.add("animated"):this.canvas.classList.remove("animated")}return this.trigger("load",this),this.valid},o.create_=function(){this.parseMode_(),this.parseMesh_(),e.prototype.create_.call(this),this.createBuffers_(),this.createTextures_()},o.parseMode_=function(){if(this.canvas.hasAttribute("data-mode")){var t=this.canvas.getAttribute("data-mode");-1!==["flat","box","sphere","torus","mesh"].indexOf(t)&&(this.mode=t)}},o.parseMesh_=function(){if(this.canvas.hasAttribute("data-mesh")){var t=this.canvas.getAttribute("data-mesh");-1!==t.indexOf(".obj")&&(this.mesh=this.defaultMesh=t)}},o.createBuffers_=function(){var e=this;Object.keys(this.buffers.values).forEach((function(n){var i=e.buffers.values[n];e.uniforms.create(t.UniformMethod.Uniform1i,t.UniformType.Sampler2D,i.key,[i.input.index])}))},o.createTextures_=function(){var t=this;this.parseTextures_(this.fragmentString)&&(this.textureList.filter((function(t){return t.url})).forEach((function(e){t.setTexture(e.key,e.url,e.options)})),this.textureList=[])},o.update_=function(){e.prototype.update_.call(this),this.updateBuffers_(),this.updateTextures_()},o.updateBuffers_=function(){var e=this;Object.keys(this.buffers.values).forEach((function(n){var i=e.buffers.values[n];e.uniforms.update(t.UniformMethod.Uniform1i,t.UniformType.Sampler2D,i.key,[i.input.index])}))},o.updateTextures_=function(){var e=this,n=this.gl;Object.keys(this.textures.values).forEach((function(i){var r=e.textures.values[i];r.tryUpdate(n),e.uniforms.update(t.UniformMethod.Uniform1i,t.UniformType.Sampler2D,r.key,[r.index])}))},o.destroyContext_=function(){var t=this,e=this.gl;e.useProgram(null),this.program&&e.deleteProgram(this.program),Object.keys(this.buffers.values).forEach((function(n){t.buffers.values[n].destroy(e)})),Object.keys(this.textures.values).forEach((function(n){t.textures.values[n].destroy(e)})),this.buffers=null,this.textures=null,this.uniforms=null,this.program=null,this.gl=null},o.swapCanvas_=function(){var t=this.canvas,e=t.cloneNode();t.parentNode.replaceChild(e,t),this.canvas=e,this.addCanvasListeners_()},o.destroy=function(){this.removeListeners_(),this.destroyContext_(),this.animated=!1,this.valid=!1;var t=i.items.indexOf(this);-1!==t&&i.items.splice(t,1)},o.loadTexture=function(e,n,i){var r=this;void 0===i&&(i={}),this.valid?this.textures.createOrUpdate(this.gl,e,n,this.buffers.count,i,this.options.workpath).then((function(n){var i=n.index;r.uniforms.createTexture(e,i).texture=n;var o=-1!==e.indexOf("[")?e.replace("[","Resolution["):e+"Resolution";return r.uniforms.create(t.UniformMethod.Uniform2f,t.UniformType.Float,o,[n.width,n.height]),n}),(function(t){var i=Array.isArray(t.path)?t.path.map((function(t){return t.error?t.error.message:""})).join(", "):t.message;D.error("GlslCanvas.loadTexture.error",e,n,i),r.trigger("textureError",{key:e,urlElementOrData:n,message:i})})):this.textureList.push({key:e,url:n,options:i})},o.setTexture=function(t,e,n){return void 0===n&&(n={}),this.setUniform_(t,[e],n)},o.setUniform=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.setUniform_(t,n)},o.setUniformOfInt=function(e,n){return this.setUniform_(e,n,null,t.UniformType.Int)},o.setUniforms=function(t){var e=this;Object.keys(t).forEach((function(n){e.setUniform(n,t[n])}))},o.pause=function(){this.valid&&(this.timer.pause(),this.canvas.classList.add("paused"),this.trigger("pause"))},o.play=function(){this.valid&&(this.timer.play(),this.canvas.classList.remove("paused"),this.trigger("play"))},o.toggle=function(){this.valid&&(this.timer.paused?this.play():this.pause())},o.checkRender=function(){this.isVisible_()&&(this.sizeDidChanged_()||this.isDirty_()||this.isAnimated_())?(this.render(),this.canvas.classList.add("playing")):this.canvas.classList.remove("playing")},i}(Ct);function Rt(t,e){return Ft.items.find((function(e){return e.canvas===t}))||new Ft(t,e)}function kt(){return[].slice.call(document.getElementsByClassName("glsl-canvas")).filter((function(t){return t instanceof HTMLCanvasElement})).map((function(t){return Rt(t)}))}Ft.items=[],document&&document.addEventListener("DOMContentLoaded",(function(){kt()})),t.BoxGeometry=lt,t.Buffer=Y,t.Buffers=K,t.Canvas=Ft,t.CanvasTimer=at,t.Common=k,t.Context=j,t.ContextVertexBuffers=V,t.DefaultWebGL2BufferFragment=w,t.DefaultWebGL2BufferVertex=y,t.DefaultWebGL2FlatFragment=m,t.DefaultWebGL2MeshFragment=v,t.DefaultWebGL2MeshVertex=f,t.DefaultWebGLBufferFragment=b,t.DefaultWebGLBufferVertex=g,t.DefaultWebGLFlatFragment=p,t.DefaultWebGLMeshFragment=_,t.DefaultWebGLMeshVertex=d,t.FlatGeometry=X,t.Geometry=W,t.IOBuffer=q,t.IterableStringMap=G,t.Listener=st,t.Logger=D,t.METHODS_FLOAT=Tt,t.METHODS_FLOATV=Ut,t.METHODS_INT=Et,t.METHODS_INTV=At,t.ObjLoader=pt,t.OrbitCamera=$,t.Renderer=Ct,t.SphereGeometry=ct,t.Subscriber=ut,t.Texture=wt,t.TextureExtensions=vt,t.TextureImageExtensions=mt,t.TextureVideoExtensions=_t,t.Textures=xt,t.TorusGeometry=ht,t.Uniform=Mt,t.UniformTexture=St,t.Uniforms=Lt,t.Vector2=J,t.Vector3=Q,t.isTextureData=gt,t.loadAll=kt,t.of=Rt,Object.defineProperty(t,"__esModule",{value:!0})})),function(){"use strict";var t={function:!0,object:!0};function e(t){return t&&t.Object===Object?t:null}parseFloat,parseInt;var n=t[typeof exports]&&exports&&!exports.nodeType?exports:void 0,i=t[typeof module]&&module&&!module.nodeType?module:void 0,r=i&&i.exports===n?n:void 0,o=e(n&&i&&"object"==typeof global&&global),a=e(t[typeof self]&&self),s=e(t[typeof window]&&window),u=e(t[typeof this]&&this),l=o||s!==(u&&u.window)&&s||a||u||Function("return this")();function c(t){return String("0000000"+t).slice(-7)}"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){for(var i=atob(this.toDataURL(e,n).split(",")[1]),r=i.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=i.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))}}),
// @license http://opensource.org/licenses/MIT
function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}();var h=window.Date.now();function d(t){var e={};this.settings=t,this.on=function(t,n){e[t]=n},this.emit=function(t){var n=e[t];n&&n.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=t.name||function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),this.extension="",this.mimeType=""}function f(t){d.call(this,t),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.baseFilename=this.filename,this.tape=null,this.count=0,this.part=1,this.frames=0}function p(t){f.call(this,t),this.type="image/png",this.fileExtension=".png"}function m(t){f.call(this,t),this.type="image/jpeg",this.fileExtension=".jpg",this.quality=t.quality/100||.8}function _(t){"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format"),d.call(this,t),this.quality=t.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=t.framerate,this.frames=0,this.part=1,this.videoWriter=new WebMWriter({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}function v(t){d.call(this,t),t.quality=t.quality/100||.8,this.encoder=new FFMpegServer.Video(t),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(t,e){var n=this.callback;n&&(this.callback=void 0,n(t,e))}.bind(this)),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("error",function(t){alert(JSON.stringify(t,null,2))}.bind(this))}function g(t){d.call(this,t),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function y(t){d.call(this,t),t.quality=31-(30*t.quality/100||10),t.workers=t.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:t.workers,quality:t.quality,workerScript:t.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){var e=this.callback;e&&(this.callback=void 0,e(t))}.bind(this))}function b(t){var e,n,i,r,o,a,s,u=t||{},l=(new Date,[]),c=[],d=0,f=0,b=[],w=!1,x={};u.framerate=u.framerate||60,u.motionBlurFrames=2*(u.motionBlurFrames||1),e=u.verbose||!1,u.display,u.step=1e3/u.framerate,u.timeLimit=u.timeLimit||0,u.frameLimit=u.frameLimit||0,u.startTime=u.startTime||0;var E=document.createElement("div");E.style.position="absolute",E.style.left=E.style.top=0,E.style.backgroundColor="black",E.style.fontFamily="monospace",E.style.fontSize="11px",E.style.padding="5px",E.style.color="red",E.style.zIndex=1e5,u.display&&document.body.appendChild(E);var T,A,U=document.createElement("canvas"),M=U.getContext("2d");G("Step is set to "+u.step+"ms");var S={gif:y,webm:_,ffmpegserver:v,png:p,jpg:m,"webm-mediarecorder":g},L=S[u.format];if(!L)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(S).join(", ");if((s=new L(u)).step=a,s.on("process",H),s.on("progress",(function(t){!function(t){var e=x[t];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}("progress",t)})),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var C=Date.now();performance.timing&&performance.timing.navigationStart&&(C=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-C}}var F=window.setTimeout,R=window.setInterval,k=window.clearInterval,O=window.clearTimeout,B=window.requestAnimationFrame,P=window.Date.now,D=window.performance.now,I=window.Date.prototype.getTime,N=[];function V(){w=!1,s.stop(),G("Capturer stop"),window.setTimeout=F,window.setInterval=R,window.clearInterval=k,window.clearTimeout=O,window.requestAnimationFrame=B,window.Date.prototype.getTime=I,window.Date.now=P,window.performance.now=D}function j(t,e){F(t,0,e)}function a(){j(H)}function H(){var t=1e3/u.framerate,e=(d+f/u.motionBlurFrames)*t;n=i+e,r=o+e,N.forEach((function(t){t._hookedTime=e/1e3})),function(){var t=d/u.framerate;(u.frameLimit&&d>=u.frameLimit||u.timeLimit&&t>=u.timeLimit)&&(V(),z());var e=new Date(null);e.setSeconds(t),u.motionBlurFrames>2?E.textContent="CCapture "+u.format+" | "+d+" frames ("+f+" inter) | "+e.toISOString().substr(11,8):E.textContent="CCapture "+u.format+" | "+d+" frames | "+e.toISOString().substr(11,8)}(),G("Frame: "+d+" "+f);for(var a=0;a<l.length;a++)n>=l[a].triggerTime&&(j(l[a].callback),l.splice(a,1));for(a=0;a<c.length;a++)n>=c[a].triggerTime&&(j(c[a].callback),c[a].triggerTime+=c[a].time);b.forEach((function(t){j(t,n-h)})),b=[]}function z(t){t||(t=function(t){return download(t,s.filename+s.extension,s.mimeType),!1}),s.save(t)}function G(t){e&&console.log(t)}return{start:function(){!function(){function t(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),N.push(this)),this._hookedTime+u.startTime}G("Capturer start"),i=window.Date.now(),n=i+u.startTime,o=window.performance.now(),r=o+u.startTime,window.Date.prototype.getTime=function(){return n},window.Date.now=function(){return n},window.setTimeout=function(t,e){var i={callback:t,time:e,triggerTime:n+e};return l.push(i),G("Timeout set to "+i.time),i},window.clearTimeout=function(t){for(var e=0;e<l.length;e++)l[e]!=t||(l.splice(e,1),G("Timeout cleared"))},window.setInterval=function(t,e){var i={callback:t,time:e,triggerTime:n+e};return c.push(i),G("Interval set to "+i.time),i},window.clearInterval=function(t){return G("clear Interval"),null},window.requestAnimationFrame=function(t){b.push(t)},window.performance.now=function(){return r};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:t}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:t})}catch(t){G(t)}}(),s.start(),w=!0},capture:function(t){w&&(u.motionBlurFrames>2?(function(t){U.width===t.width&&U.height===t.height||(U.width=t.width,U.height=t.height,T=new Uint16Array(U.height*U.width*4),M.fillStyle="#0",M.fillRect(0,0,U.width,U.height))}(t),function(t){M.drawImage(t,0,0),A=M.getImageData(0,0,U.width,U.height);for(var e=0;e<T.length;e+=4)T[e]+=A.data[e],T[e+1]+=A.data[e+1],T[e+2]+=A.data[e+2];f++}(t),f>=.5*u.motionBlurFrames?function(){for(var t=A.data,e=0;e<T.length;e+=4)t[e]=2*T[e]/u.motionBlurFrames,t[e+1]=2*T[e+1]/u.motionBlurFrames,t[e+2]=2*T[e+2]/u.motionBlurFrames;for(M.putImageData(A,0,0),s.add(U),d++,f=0,G("Full MB Frame! "+d+" "+n),e=0;e<T.length;e+=4)T[e]=0,T[e+1]=0,T[e+2]=0;gc()}():a()):(s.add(t),G("Full Frame! "+ ++d)))},stop:V,save:z,on:function(t,e){x[t]=e}}}d.prototype.start=function(){},d.prototype.stop=function(){},d.prototype.add=function(){},d.prototype.save=function(){},d.prototype.dispose=function(){},d.prototype.safeToProceed=function(){return!0},d.prototype.step=function(){console.log("Step not set!")},f.prototype=Object.create(d.prototype),f.prototype.start=function(){this.dispose()},f.prototype.add=function(t){var e=new FileReader;e.onload=function(){this.tape.append(c(this.count)+this.fileExtension,new Uint8Array(e.result)),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+c(this.part),download(t,this.filename+this.extension,this.mimeType);var e=this.count;this.dispose(),this.count=e+1,this.part++,this.filename=this.baseFilename+"-part-"+c(this.part),this.frames=0,this.step()}.bind(this)):(this.count++,this.frames++,this.step())}.bind(this),e.readAsArrayBuffer(t)},f.prototype.save=function(t){t(this.tape.save())},f.prototype.dispose=function(){this.tape=new Tar,this.count=0},p.prototype=Object.create(f.prototype),p.prototype.add=function(t){t.toBlob(function(t){f.prototype.add.call(this,t)}.bind(this),this.type)},m.prototype=Object.create(f.prototype),m.prototype.add=function(t){t.toBlob(function(t){f.prototype.add.call(this,t)}.bind(this),this.type,this.quality)},_.prototype=Object.create(d.prototype),_.prototype.start=function(t){this.dispose()},_.prototype.add=function(t){this.videoWriter.addFrame(t),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+c(this.part),download(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+c(this.part),this.step()}.bind(this)):(this.frames++,this.step())},_.prototype.save=function(t){this.videoWriter.complete().then(t)},_.prototype.dispose=function(t){this.frames=0,this.videoWriter=new WebMWriter({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})},v.prototype=Object.create(d.prototype),v.prototype.start=function(){this.encoder.start(this.settings)},v.prototype.add=function(t){this.encoder.add(t)},v.prototype.save=function(t){this.callback=t,this.encoder.end()},v.prototype.safeToProceed=function(){return this.encoder.safeToProceed()},g.prototype=Object.create(d.prototype),g.prototype.add=function(t){this.stream||(this.stream=t.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()},g.prototype.save=function(t){this.mediaRecorder.onstop=function(e){var n=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],t(n)}.bind(this),this.mediaRecorder.stop()},y.prototype=Object.create(d.prototype),y.prototype.add=function(t){this.sizeSet||(this.encoder.setOption("width",t.width),this.encoder.setOption("height",t.height),this.sizeSet=!0),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.drawImage(t,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},y.prototype.save=function(t){this.callback=t,this.encoder.render()},(s||a||{}).CCapture=b,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define((function(){return b})):n&&i?(r&&((i.exports=b).CCapture=b),n.CCapture=b):l.CCapture=b}(),function(){var t=function(t){this.data=new Uint8Array(t),this.pos=0};t.prototype.seek=function(t){this.pos=t},t.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t[e]},t.prototype.writeByte=function(t){this.data[this.pos++]=t},t.prototype.writeU8=t.prototype.writeByte,t.prototype.writeU16BE=function(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t},t.prototype.writeDoubleBE=function(t){for(var e=new Uint8Array(new Float64Array([t]).buffer),n=e.length-1;n>=0;n--)this.writeByte(e[n])},t.prototype.writeFloatBE=function(t){for(var e=new Uint8Array(new Float32Array([t]).buffer),n=e.length-1;n>=0;n--)this.writeByte(e[n])},t.prototype.writeString=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t.charCodeAt(e)},t.prototype.writeEBMLVarIntWidth=function(t,e){switch(e){case 1:this.writeU8(128|t);break;case 2:this.writeU8(64|t>>8),this.writeU8(t);break;case 3:this.writeU8(32|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(16|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(8|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new RuntimeException("Bad EBML VINT size "+e)}},t.prototype.measureEBMLVarInt=function(t){if(t<127)return 1;if(t<16383)return 2;if(t<2097151)return 3;if(t<268435455)return 4;if(t<34359738367)return 5;throw new RuntimeException("EBML VINT size not supported "+t)},t.prototype.writeEBMLVarInt=function(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))},t.prototype.writeUnsignedIntBE=function(t,e){switch(void 0===e&&(e=this.measureUnsignedInt(t)),e){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new RuntimeException("Bad UINT size "+e)}},t.prototype.measureUnsignedInt=function(t){return t<256?1:t<65536?2:t<1<<24?3:t<4294967296?4:5},t.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayBufferDataStream's pos lies beyond end of buffer"},"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:window.ArrayBufferDataStream=t}(),function(){var t=function(t){return function(e){var n=[],i=Promise.resolve(),r=null,o=null;function a(t){return new Promise((function(e,n){var i=new FileReader;i.addEventListener("loadend",(function(){e(i.result)})),i.readAsArrayBuffer(t)}))}function s(t){return new Promise((function(e,n){t instanceof Uint8Array?e(t):t instanceof ArrayBuffer||ArrayBuffer.isView(t)?e(new Uint8Array(t)):t instanceof Blob?e(a(t).then((function(t){return new Uint8Array(t)}))):e(a(new Blob([t])).then((function(t){return new Uint8Array(t)})))}))}function u(t){var e=t.byteLength||t.length||t.size;if(!Number.isInteger(e))throw"Failed to determine size of element";return e}"undefined"!=typeof FileWriter&&e instanceof FileWriter?r=e:t&&e&&(o=e),this.pos=0,this.length=0,this.seek=function(t){if(t<0)throw"Offset may not be negative";if(isNaN(t))throw"Offset may not be NaN";if(t>this.length)throw"Seeking beyond the end of file is not allowed";this.pos=t},this.write=function(e){var a={offset:this.pos,data:e,length:u(e)},l=a.offset>=this.length;this.pos+=a.length,this.length=Math.max(this.length,this.pos),i=i.then((function(){if(o)return new Promise((function(e,n){s(a.data).then((function(n){var i=0,r=Buffer.from(n.buffer),s=function(n,r,u){(i+=r)>=u.length?e():t.write(o,u,i,u.length-i,a.offset+i,s)};t.write(o,r,0,r.length,a.offset,s)}))}));if(r)return new Promise((function(t,e){r.onwriteend=t,r.seek(a.offset),r.write(new Blob([a.data]))}));if(!l)for(var e=0;e<n.length;e++){var i=n[e];if(!(a.offset+a.length<=i.offset||a.offset>=i.offset+i.length)){if(a.offset<i.offset||a.offset+a.length>i.offset+i.length)throw new Error("Overwrite crosses blob boundaries");return a.offset==i.offset&&a.length==i.length?void(i.data=a.data):s(i.data).then((function(t){return i.data=t,s(a.data)})).then((function(t){a.data=t,i.data.set(a.data,a.offset-i.offset)}))}}n.push(a)}))},this.complete=function(t){return i=o||r?i.then((function(){return null})):i.then((function(){for(var e=[],i=0;i<n.length;i++)e.push(n[i].data);return new Blob(e,{mimeType:t})}))}}};"undefined"!=typeof module&&void 0!==module.exports?module.exports=t(require("fs")):window.BlobBuffer=t(null)}(),function(){var t=function(t,e){function n(t,e){var n,i=t.toDataURL("image/webp",{quality:e});return!("string"!=typeof(n=i)||!n.match(/^data:image\/webp;base64,/i))&&window.atob(n.substring("data:image/webp;base64,".length))}function i(t){var e=t.indexOf("VP8 ");if(-1==e)throw"Failed to identify beginning of keyframe in WebP image";return e+="VP8 ".length+4,t.substring(e)}function r(t){this.value=t}function o(t){this.value=t}function a(t,e,n){if(Array.isArray(n))for(var i=0;i<n.length;i++)a(t,e,n[i]);else if("string"==typeof n)t.writeString(n);else if(n instanceof Uint8Array)t.writeBytes(n);else{if(!n.id)throw"Bad EBML datatype "+typeof n.data;var s,u,l;if(n.offset=t.pos+e,t.writeUnsignedIntBE(n.id),Array.isArray(n.data))-1===n.size?t.writeByte(255):(s=t.pos,t.writeBytes([0,0,0,0])),u=t.pos,n.dataOffset=u+e,a(t,e,n.data),-1!==n.size&&(l=t.pos,n.size=l-u,t.seek(s),t.writeEBMLVarIntWidth(n.size,4),t.seek(l));else if("string"==typeof n.data)t.writeEBMLVarInt(n.data.length),n.dataOffset=t.pos+e,t.writeString(n.data);else if("number"==typeof n.data)n.size||(n.size=t.measureUnsignedInt(n.data)),t.writeEBMLVarInt(n.size),n.dataOffset=t.pos+e,t.writeUnsignedIntBE(n.data,n.size);else if(n.data instanceof o)t.writeEBMLVarInt(8),n.dataOffset=t.pos+e,t.writeDoubleBE(n.data.value);else if(n.data instanceof r)t.writeEBMLVarInt(4),n.dataOffset=t.pos+e,t.writeFloatBE(n.data.value);else{if(!(n.data instanceof Uint8Array))throw"Bad EBML datatype "+typeof n.data;t.writeEBMLVarInt(n.data.byteLength),n.dataOffset=t.pos+e,t.writeBytes(n.data)}}}return function(r){var s,u,l,c,h,d=!1,f=[],p=0,m=0,_={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},v={id:17545,data:new o(0)},g=[],y=new e(r.fileWriter||r.fd);function b(t){return t-l.dataOffset}function w(){c=function(){var t={id:21420,size:5,data:0},e={id:290298740,data:[]};for(var n in _){var i=_[n];i.positionEBML=Object.create(t),e.data.push({id:19899,data:[{id:21419,data:i.id},i.positionEBML]})}return e}();var e={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},v]},n={id:374648427,data:[{id:174,data:[{id:215,data:1},{id:29637,data:1},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:[{id:176,data:s},{id:186,data:u}]}]}]};l={id:408125543,size:-1,data:[c,e,n]};var i=new t(256);a(i,y.pos,[{id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},l]),y.write(i.getAsDataArray()),_.SegmentInfo.positionEBML.data=b(e.offset),_.Tracks.positionEBML.data=b(n.offset)}function x(e){var n=new t(4);if(!(e.trackNumber>0&&e.trackNumber<127))throw"TrackNumber must be > 0 and < 127";return n.writeEBMLVarInt(e.trackNumber),n.writeU16BE(e.timecode),n.writeByte(128),{id:163,data:[n.getAsDataArray(),e.frame]}}function E(){if(0!=f.length){for(var e=0,n=0;n<f.length;n++)e+=f[n].frame.length;var i,r,o,s=new t(e+32*f.length),u=function(t){return{id:524531317,data:[{id:231,data:Math.round(t.timecode)}]}}({timecode:Math.round(p)});for(n=0;n<f.length;n++)u.data.push(x(f[n]));a(s,y.pos,u),y.write(s.getAsDataArray()),i=1,r=Math.round(p),o=u.offset,g.push({id:187,data:[{id:179,data:r},{id:183,data:[{id:247,data:i},{id:241,data:b(o)}]}]}),f=[],p+=m,m=0}}this.addFrame=function(t){if(d){if(t.width!=s||t.height!=u)throw"Frame size differs from previous frames"}else s=t.width,u=t.height,w(),d=!0;var e,o=n(t,{quality:r.quality});if(!o)throw"Couldn't decode WebP frame, does the browser support WebP?";(e={frame:i(o),duration:r.frameDuration}).trackNumber=1,e.timecode=Math.round(m),f.push(e),(m+=e.duration)>=5e3&&E()},this.complete=function(){var e,n,i,r;return E(),e={id:475249515,data:g},a(n=new t(16+32*g.length),y.pos,e),y.write(n.getAsDataArray()),_.Cues.positionEBML.data=b(e.offset),i=new t(c.size),r=y.pos,a(i,c.dataOffset,c.data),y.seek(c.dataOffset),y.write(i.getAsDataArray()),y.seek(r),function(){var e=new t(8),n=y.pos;e.writeDoubleBE(p),y.seek(v.dataOffset),y.write(e.getAsDataArray()),y.seek(n)}(),y.complete("video/webm")},this.getWrittenSize=function(){return y.length},h={},[{quality:.95,fileWriter:null,fd:null,frameDuration:null,frameRate:null},r||{}].forEach((function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])})),r=h,function(){if(!r.frameDuration){if(!r.frameRate)throw"Missing required frameDuration or frameRate setting";r.frameDuration=1e3/r.frameRate}}()}};"undefined"!=typeof module&&void 0!==module.exports?module.exports=t(require("./ArrayBufferDataStream"),require("./BlobBuffer")):window.WebMWriter=t(ArrayBufferDataStream,BlobBuffer)}();
//# sourceMappingURL=vendors.min.js.map